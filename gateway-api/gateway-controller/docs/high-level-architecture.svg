<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 14.0.4 (20251115.1723)
 -->
<!-- Title: HighLevelArchitecture Pages: 1 -->
<svg width="993pt" height="2043pt"
 viewBox="0.00 0.00 993.00 2043.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2038.87)">
<title>HighLevelArchitecture</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-2038.87 988.5,-2038.87 988.5,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_k8s_resources</title>
<polygon fill="lightgrey" stroke="lightgrey" points="85,-1784.12 85,-2026.87 227,-2026.87 227,-1784.12 85,-1784.12"/>
<text xml:space="preserve" text-anchor="middle" x="156" y="-2009.57" font-family="Times,serif" font-size="14.00">Kubernetes Resources</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_controllers</title>
<polygon fill="#fff9c4" stroke="#fff9c4" points="244,-1143.12 244,-1726.62 496,-1726.62 496,-1143.12 244,-1143.12"/>
<text xml:space="preserve" text-anchor="middle" x="370" y="-1709.32" font-family="Times,serif" font-size="14.00">Controller Layer</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_ssh</title>
<polygon fill="#ffe0b2" stroke="#ffe0b2" points="93,-654.87 93,-953.62 351,-953.62 351,-654.87 93,-654.87"/>
<text xml:space="preserve" text-anchor="middle" x="222" y="-936.32" font-family="Times,serif" font-size="14.00">SSH Layer</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_external</title>
<polygon fill="#f3e5f5" stroke="#f3e5f5" points="8,-8 8,-545.37 375,-545.37 375,-8 8,-8"/>
<text xml:space="preserve" text-anchor="middle" x="191.5" y="-528.07" font-family="Times,serif" font-size="14.00">External Systems</text>
</g>
<!-- resources -->
<g id="node1" class="node">
<title>resources</title>
<path fill="lightgrey" stroke="none" d="M206.75,-1994.37C206.75,-1994.37 105.25,-1994.37 105.25,-1994.37 99.25,-1994.37 93.25,-1988.37 93.25,-1982.37 93.25,-1982.37 93.25,-1804.12 93.25,-1804.12 93.25,-1798.12 99.25,-1792.12 105.25,-1792.12 105.25,-1792.12 206.75,-1792.12 206.75,-1792.12 212.75,-1792.12 218.75,-1798.12 218.75,-1804.12 218.75,-1804.12 218.75,-1982.37 218.75,-1982.37 218.75,-1988.37 212.75,-1994.37 206.75,-1994.37"/>
<polygon fill="#e1f5fe" stroke="none" points="101.25,-1958.12 101.25,-1990.37 210.75,-1990.37 210.75,-1958.12 101.25,-1958.12"/>
<polygon fill="none" stroke="black" points="101.25,-1958.12 101.25,-1990.37 210.75,-1990.37 210.75,-1958.12 101.25,-1958.12"/>
<text xml:space="preserve" text-anchor="start" x="115.5" y="-1970.97" font-family="Arial" font-weight="bold" font-size="12.00">GatewayClass</text>
<polygon fill="#e1f5fe" stroke="none" points="101.25,-1904.12 101.25,-1958.12 210.75,-1958.12 210.75,-1904.12 101.25,-1904.12"/>
<polygon fill="none" stroke="black" points="101.25,-1904.12 101.25,-1958.12 210.75,-1958.12 210.75,-1904.12 101.25,-1904.12"/>
<text xml:space="preserve" text-anchor="start" x="131.62" y="-1938.72" font-family="Arial" font-weight="bold" font-size="12.00">Gateway</text>
<text xml:space="preserve" text-anchor="start" x="127.88" y="-1926.72" font-family="Arial" font-size="12.00">• Listeners</text>
<text xml:space="preserve" text-anchor="start" x="121.88" y="-1914.72" font-family="Arial" font-size="12.00">• SSH config</text>
<polygon fill="#e1f5fe" stroke="none" points="101.25,-1850.12 101.25,-1904.12 210.75,-1904.12 210.75,-1850.12 101.25,-1850.12"/>
<polygon fill="none" stroke="black" points="101.25,-1850.12 101.25,-1904.12 210.75,-1904.12 210.75,-1850.12 101.25,-1850.12"/>
<text xml:space="preserve" text-anchor="start" x="122.62" y="-1884.72" font-family="Arial" font-weight="bold" font-size="12.00">HTTPRoute</text>
<text xml:space="preserve" text-anchor="start" x="110.25" y="-1872.72" font-family="Arial" font-size="12.00">• Hostname rules</text>
<text xml:space="preserve" text-anchor="start" x="125.62" y="-1860.72" font-family="Arial" font-size="12.00">• Backends</text>
<polygon fill="#e1f5fe" stroke="none" points="101.25,-1796.12 101.25,-1850.12 210.75,-1850.12 210.75,-1796.12 101.25,-1796.12"/>
<polygon fill="none" stroke="black" points="101.25,-1796.12 101.25,-1850.12 210.75,-1850.12 210.75,-1796.12 101.25,-1796.12"/>
<text xml:space="preserve" text-anchor="start" x="126.38" y="-1830.72" font-family="Arial" font-weight="bold" font-size="12.00">TCPRoute</text>
<text xml:space="preserve" text-anchor="start" x="126.75" y="-1818.72" font-family="Arial" font-size="12.00">• Port rules</text>
<text xml:space="preserve" text-anchor="start" x="125.62" y="-1806.72" font-family="Arial" font-size="12.00">• Backends</text>
</g>
<!-- route_controllers -->
<g id="node2" class="node">
<title>route_controllers</title>
<path fill="lightgrey" stroke="none" d="M466.12,-1694.12C466.12,-1694.12 273.88,-1694.12 273.88,-1694.12 267.88,-1694.12 261.88,-1688.12 261.88,-1682.12 261.88,-1682.12 261.88,-1541.37 261.88,-1541.37 261.88,-1535.37 267.88,-1529.37 273.88,-1529.37 273.88,-1529.37 466.12,-1529.37 466.12,-1529.37 472.12,-1529.37 478.12,-1535.37 478.12,-1541.37 478.12,-1541.37 478.12,-1682.12 478.12,-1682.12 478.12,-1688.12 472.12,-1694.12 466.12,-1694.12"/>
<polygon fill="#90caf9" stroke="none" points="269.88,-1657.87 269.88,-1690.12 470.12,-1690.12 470.12,-1657.87 269.88,-1657.87"/>
<polygon fill="none" stroke="black" points="269.88,-1657.87 269.88,-1690.12 470.12,-1690.12 470.12,-1657.87 269.88,-1657.87"/>
<text xml:space="preserve" text-anchor="start" x="319.38" y="-1670.72" font-family="Arial" font-weight="bold" font-size="12.00">Route Controllers</text>
<polygon fill="#bbdefb" stroke="none" points="269.88,-1611.37 269.88,-1657.87 373.38,-1657.87 373.38,-1611.37 269.88,-1611.37"/>
<polygon fill="none" stroke="black" points="269.88,-1611.37 269.88,-1657.87 373.38,-1657.87 373.38,-1611.37 269.88,-1611.37"/>
<text xml:space="preserve" text-anchor="start" x="289.38" y="-1637.47" font-family="Arial" font-size="12.00">HTTPRoute</text>
<text xml:space="preserve" text-anchor="start" x="292.75" y="-1623.22" font-family="Arial" font-size="12.00">Reconciler</text>
<polygon fill="#bbdefb" stroke="none" points="373.38,-1611.37 373.38,-1657.87 470.12,-1657.87 470.12,-1611.37 373.38,-1611.37"/>
<polygon fill="none" stroke="black" points="373.38,-1611.37 373.38,-1657.87 470.12,-1657.87 470.12,-1611.37 373.38,-1611.37"/>
<text xml:space="preserve" text-anchor="start" x="393.25" y="-1637.47" font-family="Arial" font-size="12.00">TCPRoute</text>
<text xml:space="preserve" text-anchor="start" x="392.88" y="-1623.22" font-family="Arial" font-size="12.00">Reconciler</text>
<polygon fill="none" stroke="black" points="269.88,-1533.37 269.88,-1611.37 470.12,-1611.37 470.12,-1533.37 269.88,-1533.37"/>
<text xml:space="preserve" text-anchor="start" x="330.62" y="-1593.87" font-family="Arial" font-weight="bold" font-size="10.00">Responsibilities:</text>
<text xml:space="preserve" text-anchor="start" x="293.5" y="-1583.87" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Watch route resources</text>
<text xml:space="preserve" text-anchor="start" x="282.62" y="-1573.87" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Periodic reconciliation (10s)</text>
<text xml:space="preserve" text-anchor="start" x="286.75" y="-1563.87" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Validate forwardings exist</text>
<text xml:space="preserve" text-anchor="start" x="278.88" y="-1553.87" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Call SetRoute/RemoveRoute</text>
<text xml:space="preserve" text-anchor="start" x="304.38" y="-1543.87" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Fail fast on errors</text>
</g>
<!-- resources&#45;&gt;route_controllers -->
<g id="edge1" class="edge">
<title>resources&#45;&gt;route_controllers</title>
<path fill="none" stroke="#2196f3" stroke-width="2" stroke-dasharray="5,2" d="M218.36,-1848C255.12,-1848 294.5,-1848 294.5,-1848 294.5,-1848 294.5,-1707.07 294.5,-1707.07"/>
<polygon fill="#2196f3" stroke="#2196f3" stroke-width="2" points="298,-1707.07 294.5,-1697.07 291,-1707.07 298,-1707.07"/>
<text xml:space="preserve" text-anchor="middle" x="280.25" y="-1739.62" font-family="Arial" font-size="10.00"> &#160;watch events &#160;</text>
</g>
<!-- gateway_controller -->
<g id="node3" class="node">
<title>gateway_controller</title>
<path fill="lightgrey" stroke="none" d="M476.25,-1339.37C476.25,-1339.37 263.75,-1339.37 263.75,-1339.37 257.75,-1339.37 251.75,-1333.37 251.75,-1327.37 251.75,-1327.37 251.75,-1163.12 251.75,-1163.12 251.75,-1157.12 257.75,-1151.12 263.75,-1151.12 263.75,-1151.12 476.25,-1151.12 476.25,-1151.12 482.25,-1151.12 488.25,-1157.12 488.25,-1163.12 488.25,-1163.12 488.25,-1327.37 488.25,-1327.37 488.25,-1333.37 482.25,-1339.37 476.25,-1339.37"/>
<polygon fill="#a5d6a7" stroke="none" points="259.75,-1303.12 259.75,-1335.37 480.25,-1335.37 480.25,-1303.12 259.75,-1303.12"/>
<polygon fill="none" stroke="black" points="259.75,-1303.12 259.75,-1335.37 480.25,-1335.37 480.25,-1303.12 259.75,-1303.12"/>
<text xml:space="preserve" text-anchor="start" x="315.62" y="-1315.97" font-family="Arial" font-weight="bold" font-size="12.00">Gateway Controller</text>
<polygon fill="none" stroke="black" points="259.75,-1155.12 259.75,-1303.12 480.25,-1303.12 480.25,-1155.12 259.75,-1155.12"/>
<text xml:space="preserve" text-anchor="start" x="330.62" y="-1285.62" font-family="Arial" font-weight="bold" font-size="10.00">Responsibilities:</text>
<text xml:space="preserve" text-anchor="start" x="284.88" y="-1275.62" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Watch Gateway resources</text>
<text xml:space="preserve" text-anchor="start" x="282.62" y="-1265.62" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Periodic reconciliation (30s)</text>
<text xml:space="preserve" text-anchor="start" x="276.62" y="-1255.62" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Check SSH connection health</text>
<text xml:space="preserve" text-anchor="start" x="287.12" y="-1245.62" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Reconnect on disconnect</text>
<text xml:space="preserve" text-anchor="start" x="271.38" y="-1235.62" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Provide gateway/listener registry</text>
<text xml:space="preserve" text-anchor="start" x="286.75" y="-1225.62" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Provide validation helpers</text>
<text xml:space="preserve" text-anchor="start" x="310.75" y="-1205.62" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="358.75" y="-1205.62" font-family="Arial" font-weight="bold" font-size="10.00">Key Functions:</text>
<text xml:space="preserve" text-anchor="start" x="278.5" y="-1195.62" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• SetRoute() &#45; setup forwarding</text>
<text xml:space="preserve" text-anchor="start" x="283.75" y="-1185.62" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• RemoveRoute() &#45; teardown</text>
<text xml:space="preserve" text-anchor="start" x="280" y="-1175.62" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• isForwardingValid() &#45; validate</text>
<text xml:space="preserve" text-anchor="start" x="268.75" y="-1165.62" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• updateGatewayStatus() &#45; K8s API</text>
</g>
<!-- resources&#45;&gt;gateway_controller -->
<g id="edge2" class="edge">
<title>resources&#45;&gt;gateway_controller</title>
<path fill="none" stroke="#2196f3" stroke-width="2" stroke-dasharray="5,2" d="M218.7,-1820C239.2,-1820 256.81,-1820 256.81,-1820 256.81,-1820 256.81,-1352.22 256.81,-1352.22"/>
<polygon fill="#2196f3" stroke="#2196f3" stroke-width="2" points="260.31,-1352.22 256.81,-1342.22 253.31,-1352.22 260.31,-1352.22"/>
<text xml:space="preserve" text-anchor="middle" x="154.25" y="-1608.24" font-family="Arial" font-size="10.00"> &#160;watch events &#160;</text>
</g>
<!-- route_controllers&#45;&gt;gateway_controller -->
<g id="edge3" class="edge">
<title>route_controllers&#45;&gt;gateway_controller</title>
<path fill="none" stroke="#4caf50" stroke-width="2" d="M370,-1529.49C370,-1529.49 370,-1352.2 370,-1352.2"/>
<polygon fill="#4caf50" stroke="#4caf50" stroke-width="2" points="373.5,-1352.2 370,-1342.2 366.5,-1352.2 373.5,-1352.2"/>
<text xml:space="preserve" text-anchor="start" x="396" y="-1475.87" font-family="Arial" font-weight="bold" font-size="10.00">SetRoute()</text>
<text xml:space="preserve" text-anchor="start" x="372" y="-1458.87" font-family="Arial" font-size="10.00">• gateway/listener info</text>
<text xml:space="preserve" text-anchor="start" x="390.38" y="-1442.87" font-family="Arial" font-size="10.00">• route details</text>
<text xml:space="preserve" text-anchor="start" x="378" y="-1426.87" font-family="Arial" font-size="10.00">• backend host:port</text>
<text xml:space="preserve" text-anchor="start" x="384.38" y="-1401.87" font-family="Arial" font-weight="bold" font-size="10.00">RemoveRoute()</text>
<text xml:space="preserve" text-anchor="start" x="376.12" y="-1386.87" font-family="Arial" font-size="10.00">• cleanup forwarding</text>
</g>
<!-- ssh_manager -->
<g id="node4" class="node">
<title>ssh_manager</title>
<path fill="lightgrey" stroke="none" d="M331.25,-921.12C331.25,-921.12 112.75,-921.12 112.75,-921.12 106.75,-921.12 100.75,-915.12 100.75,-909.12 100.75,-909.12 100.75,-674.87 100.75,-674.87 100.75,-668.87 106.75,-662.87 112.75,-662.87 112.75,-662.87 331.25,-662.87 331.25,-662.87 337.25,-662.87 343.25,-668.87 343.25,-674.87 343.25,-674.87 343.25,-909.12 343.25,-909.12 343.25,-915.12 337.25,-921.12 331.25,-921.12"/>
<polygon fill="#ffcc80" stroke="none" points="108.75,-884.87 108.75,-917.12 335.25,-917.12 335.25,-884.87 108.75,-884.87"/>
<polygon fill="none" stroke="black" points="108.75,-884.87 108.75,-917.12 335.25,-917.12 335.25,-884.87 108.75,-884.87"/>
<text xml:space="preserve" text-anchor="start" x="162" y="-897.72" font-family="Arial" font-weight="bold" font-size="12.00">SSH Tunnel Manager</text>
<polygon fill="none" stroke="black" points="108.75,-666.87 108.75,-884.87 335.25,-884.87 335.25,-666.87 108.75,-666.87"/>
<text xml:space="preserve" text-anchor="start" x="182.62" y="-867.37" font-family="Arial" font-weight="bold" font-size="10.00">Responsibilities:</text>
<text xml:space="preserve" text-anchor="start" x="124.12" y="-857.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Establish/close SSH connection</text>
<text xml:space="preserve" text-anchor="start" x="124.88" y="-847.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Send keepalives, detect failures</text>
<text xml:space="preserve" text-anchor="start" x="146.62" y="-837.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Start/stop forwardings</text>
<text xml:space="preserve" text-anchor="start" x="134.25" y="-827.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Validate hostname matches</text>
<text xml:space="preserve" text-anchor="start" x="150.75" y="-817.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Maintain clean state</text>
<text xml:space="preserve" text-anchor="start" x="140.25" y="-807.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Proxy traffic to backends</text>
<text xml:space="preserve" text-anchor="start" x="156.38" y="-797.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Fail fast on errors</text>
<text xml:space="preserve" text-anchor="start" x="117.75" y="-787.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Does NOT reconnect automatically</text>
<text xml:space="preserve" text-anchor="start" x="162.75" y="-767.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="210.75" y="-767.37" font-family="Arial" font-weight="bold" font-size="10.00">Key Functions:</text>
<text xml:space="preserve" text-anchor="start" x="147" y="-757.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• Connect/IsConnected</text>
<text xml:space="preserve" text-anchor="start" x="124.5" y="-747.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• StartForwarding/StopForwarding</text>
<text xml:space="preserve" text-anchor="start" x="124.5" y="-737.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• GetAssignedAddresses (RLock)</text>
<text xml:space="preserve" text-anchor="start" x="129.75" y="-727.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• handleChannels (traffic proxy)</text>
<text xml:space="preserve" text-anchor="start" x="118.12" y="-717.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• monitorConnection (keepalive only)</text>
<text xml:space="preserve" text-anchor="start" x="139.12" y="-697.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text xml:space="preserve" text-anchor="start" x="187.12" y="-697.37" font-family="Arial" font-weight="bold" font-size="10.00">State (always consistent):</text>
<text xml:space="preserve" text-anchor="start" x="158.62" y="-687.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• forwardings map</text>
<text xml:space="preserve" text-anchor="start" x="151.5" y="-677.37" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;• assignedAddrs map</text>
</g>
<!-- gateway_controller&#45;&gt;ssh_manager -->
<g id="edge4" class="edge">
<title>gateway_controller&#45;&gt;ssh_manager</title>
<path fill="none" stroke="#ff9800" stroke-width="2" d="M297.5,-1151.33C297.5,-1151.33 297.5,-934.05 297.5,-934.05"/>
<polygon fill="#ff9800" stroke="#ff9800" stroke-width="2" points="301,-934.05 297.5,-924.05 294,-934.05 301,-934.05"/>
<text xml:space="preserve" text-anchor="start" x="256" y="-1097.62" font-family="Arial" font-weight="bold" font-size="10.00">Connection Management:</text>
<text xml:space="preserve" text-anchor="start" x="281.5" y="-1080.62" font-family="Arial" font-size="10.00">• IsConnected()</text>
<text xml:space="preserve" text-anchor="start" x="290.88" y="-1064.62" font-family="Arial" font-size="10.00">• Connect()</text>
<text xml:space="preserve" text-anchor="start" x="260.5" y="-1039.62" font-family="Arial" font-weight="bold" font-size="10.00">Forwarding Operations:</text>
<text xml:space="preserve" text-anchor="start" x="274.75" y="-1024.62" font-family="Arial" font-size="10.00">• StartForwarding()</text>
<text xml:space="preserve" text-anchor="start" x="275.12" y="-1008.62" font-family="Arial" font-size="10.00">• StopForwarding()</text>
<text xml:space="preserve" text-anchor="start" x="290.88" y="-983.62" font-family="Arial" font-weight="bold" font-size="10.00">Validation:</text>
<text xml:space="preserve" text-anchor="start" x="257.88" y="-968.62" font-family="Arial" font-size="10.00">• GetAssignedAddresses()</text>
</g>
<!-- k8s_api -->
<g id="node8" class="node">
<title>k8s_api</title>
<ellipse fill="#ffebee" stroke="black" cx="486" cy="-791.99" rx="70.71" ry="25.81"/>
<text xml:space="preserve" text-anchor="middle" x="486" y="-794.84" font-family="Arial" font-size="12.00">Kubernetes API</text>
<text xml:space="preserve" text-anchor="middle" x="486" y="-780.59" font-family="Arial" font-size="12.00">Server</text>
</g>
<!-- gateway_controller&#45;&gt;k8s_api -->
<g id="edge9" class="edge">
<title>gateway_controller&#45;&gt;k8s_api</title>
<path fill="none" stroke="#2196f3" stroke-width="2" stroke-dasharray="1,5" d="M451.77,-1151.33C451.77,-1151.33 451.77,-827.68 451.77,-827.68"/>
<polygon fill="#2196f3" stroke="#2196f3" stroke-width="2" points="455.27,-827.68 451.77,-817.68 448.27,-827.68 455.27,-827.68"/>
<text xml:space="preserve" text-anchor="middle" x="529.5" y="-1038.62" font-family="Arial" font-size="10.00"> &#160;update Gateway</text>
<text xml:space="preserve" text-anchor="middle" x="529.5" y="-1026.62" font-family="Arial" font-size="10.00"> &#160;status/addresses &#160;</text>
</g>
<!-- ssh_server -->
<g id="node5" class="node">
<title>ssh_server</title>
<path fill="#e1bee7" stroke="black" d="M155.5,-512.87C155.5,-512.87 28.5,-512.87 28.5,-512.87 22.5,-512.87 16.5,-506.87 16.5,-500.87 16.5,-500.87 16.5,-431.62 16.5,-431.62 16.5,-425.62 22.5,-419.62 28.5,-419.62 28.5,-419.62 155.5,-419.62 155.5,-419.62 161.5,-419.62 167.5,-425.62 167.5,-431.62 167.5,-431.62 167.5,-500.87 167.5,-500.87 167.5,-506.87 161.5,-512.87 155.5,-512.87"/>
<text xml:space="preserve" text-anchor="middle" x="92" y="-497.47" font-family="Arial" font-size="12.00">SSH Server</text>
<text xml:space="preserve" text-anchor="middle" x="92" y="-483.22" font-family="Arial" font-size="12.00">(pico.sh / tuns.sh)</text>
<text xml:space="preserve" text-anchor="middle" x="92" y="-454.97" font-family="Arial" font-size="12.00">• Reverse port forwarding</text>
<text xml:space="preserve" text-anchor="middle" x="92" y="-440.72" font-family="Arial" font-size="12.00">• Hostname assignment</text>
<text xml:space="preserve" text-anchor="middle" x="92" y="-426.47" font-family="Arial" font-size="12.00">• Public endpoint</text>
</g>
<!-- ssh_manager&#45;&gt;ssh_server -->
<g id="edge5" class="edge">
<title>ssh_manager&#45;&gt;ssh_server</title>
<path fill="none" stroke="#f44336" stroke-width="2" d="M134.12,-650.22C134.12,-650.22 134.12,-526.37 134.12,-526.37"/>
<polygon fill="#f44336" stroke="#f44336" stroke-width="2" points="130.63,-650.22 134.13,-660.22 137.63,-650.22 130.63,-650.22"/>
<polygon fill="#f44336" stroke="#f44336" stroke-width="2" points="137.63,-526.37 134.13,-516.37 130.63,-526.37 137.63,-526.37"/>
<text xml:space="preserve" text-anchor="start" x="125.38" y="-609.37" font-family="Arial" font-weight="bold" font-size="10.00">SSH Protocol:</text>
<text xml:space="preserve" text-anchor="start" x="109.62" y="-592.37" font-family="Arial" font-size="10.00">• tcpip&#45;forward request</text>
<text xml:space="preserve" text-anchor="start" x="111.5" y="-576.37" font-family="Arial" font-size="10.00">• cancel&#45;tcpip&#45;forward</text>
<text xml:space="preserve" text-anchor="start" x="101" y="-560.37" font-family="Arial" font-size="10.00">• forwarded&#45;tcpip channels</text>
</g>
<!-- backends -->
<g id="node6" class="node">
<title>backends</title>
<path fill="#e1bee7" stroke="black" d="M354.5,-505.74C354.5,-505.74 251.5,-505.74 251.5,-505.74 245.5,-505.74 239.5,-499.74 239.5,-493.74 239.5,-493.74 239.5,-438.74 239.5,-438.74 239.5,-432.74 245.5,-426.74 251.5,-426.74 251.5,-426.74 354.5,-426.74 354.5,-426.74 360.5,-426.74 366.5,-432.74 366.5,-438.74 366.5,-438.74 366.5,-493.74 366.5,-493.74 366.5,-499.74 360.5,-505.74 354.5,-505.74"/>
<text xml:space="preserve" text-anchor="middle" x="303" y="-490.34" font-family="Arial" font-size="12.00">Kubernetes Services</text>
<text xml:space="preserve" text-anchor="middle" x="303" y="-476.09" font-family="Arial" font-size="12.00">(Backends)</text>
<text xml:space="preserve" text-anchor="middle" x="303" y="-447.84" font-family="Arial" font-size="12.00">• ClusterIP services</text>
<text xml:space="preserve" text-anchor="middle" x="303" y="-433.59" font-family="Arial" font-size="12.00">• Internal endpoints</text>
</g>
<!-- ssh_manager&#45;&gt;backends -->
<g id="edge6" class="edge">
<title>ssh_manager&#45;&gt;backends</title>
<path fill="none" stroke="#4caf50" stroke-width="2" d="M291.38,-663.25C291.38,-663.25 291.38,-519.07 291.38,-519.07"/>
<polygon fill="#4caf50" stroke="#4caf50" stroke-width="2" points="294.88,-519.07 291.38,-509.07 287.88,-519.07 294.88,-519.07"/>
<text xml:space="preserve" text-anchor="middle" x="341.38" y="-590.37" font-family="Arial" font-size="10.00"> &#160;proxy traffic</text>
<text xml:space="preserve" text-anchor="middle" x="341.38" y="-578.37" font-family="Arial" font-size="10.00"> &#160;(forwarded&#45;tcpip) &#160;</text>
</g>
<!-- internet -->
<g id="node7" class="node">
<title>internet</title>
<ellipse fill="#e1bee7" stroke="black" cx="157" cy="-41.81" rx="39.42" ry="25.81"/>
<text xml:space="preserve" text-anchor="middle" x="157" y="-44.66" font-family="Arial" font-size="12.00">Internet</text>
<text xml:space="preserve" text-anchor="middle" x="157" y="-30.41" font-family="Arial" font-size="12.00">Clients</text>
</g>
<!-- ssh_server&#45;&gt;internet -->
<g id="edge8" class="edge">
<title>ssh_server&#45;&gt;internet</title>
<path fill="none" stroke="#9c27b0" stroke-width="2" stroke-dasharray="5,2" d="M134.22,-419.2C134.22,-419.2 134.22,-76.34 134.22,-76.34"/>
<polygon fill="#9c27b0" stroke="#9c27b0" stroke-width="2" points="137.72,-76.34 134.22,-66.34 130.72,-76.34 137.72,-76.34"/>
<text xml:space="preserve" text-anchor="middle" x="118.5" y="-240.12" font-family="Arial" font-size="10.00"> &#160;responses &#160;</text>
</g>
<!-- internet&#45;&gt;ssh_server -->
<g id="edge7" class="edge">
<title>internet&#45;&gt;ssh_server</title>
<path fill="none" stroke="#9c27b0" stroke-width="2" d="M150.86,-67.72C150.86,-67.72 150.86,-406.36 150.86,-406.36"/>
<polygon fill="#9c27b0" stroke="#9c27b0" stroke-width="2" points="147.36,-406.36 150.86,-416.36 154.36,-406.36 147.36,-406.36"/>
<text xml:space="preserve" text-anchor="middle" x="251.75" y="-246.12" font-family="Arial" font-size="10.00"> &#160;HTTP/TCP</text>
<text xml:space="preserve" text-anchor="middle" x="251.75" y="-234.12" font-family="Arial" font-size="10.00"> &#160;requests &#160;</text>
</g>
<!-- periodic_routes -->
<g id="node9" class="node">
<title>periodic_routes</title>
<polygon fill="#ffffcc" stroke="black" points="406.88,-1911.24 327.12,-1911.24 327.12,-1875.24 412.88,-1875.24 412.88,-1905.24 406.88,-1911.24"/>
<polyline fill="none" stroke="black" points="406.88,-1911.24 406.88,-1905.24"/>
<polyline fill="none" stroke="black" points="412.88,-1905.24 406.88,-1905.24"/>
<text xml:space="preserve" text-anchor="middle" x="370" y="-1888.97" font-family="Arial" font-size="12.00">Periodic: 10s</text>
</g>
<!-- periodic_routes&#45;&gt;route_controllers -->
<g id="edge10" class="edge">
<title>periodic_routes&#45;&gt;route_controllers</title>
<polygon fill="black" stroke="black" points="373.5,-1705.51 370,-1695.51 366.5,-1705.51 373.5,-1705.51"/>
</g>
<!-- periodic_gateway -->
<g id="node10" class="node">
<title>periodic_gateway</title>
<polygon fill="#ffffcc" stroke="black" points="629.88,-1629.74 550.12,-1629.74 550.12,-1593.74 635.88,-1593.74 635.88,-1623.74 629.88,-1629.74"/>
<polyline fill="none" stroke="black" points="629.88,-1629.74 629.88,-1623.74"/>
<polyline fill="none" stroke="black" points="635.88,-1623.74 629.88,-1623.74"/>
<text xml:space="preserve" text-anchor="middle" x="593" y="-1607.47" font-family="Arial" font-size="12.00">Periodic: 30s</text>
</g>
<!-- periodic_gateway&#45;&gt;gateway_controller -->
<g id="edge11" class="edge">
<title>periodic_gateway&#45;&gt;gateway_controller</title>
<polygon fill="black" stroke="black" points="486.69,-1350.73 483.19,-1340.73 479.69,-1350.73 486.69,-1350.73"/>
</g>
<!-- principles -->
<g id="node11" class="node">
<title>principles</title>
<path fill="lightgrey" stroke="none" d="M972.5,-376.62C972.5,-376.62 395.5,-376.62 395.5,-376.62 389.5,-376.62 383.5,-370.62 383.5,-364.62 383.5,-364.62 383.5,-122.62 383.5,-122.62 383.5,-116.62 389.5,-110.62 395.5,-110.62 395.5,-110.62 972.5,-110.62 972.5,-110.62 978.5,-110.62 984.5,-116.62 984.5,-122.62 984.5,-122.62 984.5,-364.62 984.5,-364.62 984.5,-370.62 978.5,-376.62 972.5,-376.62"/>
<polygon fill="#c8e6c9" stroke="none" points="391.5,-340.37 391.5,-372.62 976.5,-372.62 976.5,-340.37 391.5,-340.37"/>
<polygon fill="none" stroke="black" points="391.5,-340.37 391.5,-372.62 976.5,-372.62 976.5,-340.37 391.5,-340.37"/>
<text xml:space="preserve" text-anchor="start" x="618.75" y="-353.22" font-family="Arial" font-weight="bold" font-size="12.00">Architecture Principles</text>
<polygon fill="none" stroke="black" points="391.5,-308.12 391.5,-340.37 545.25,-340.37 545.25,-308.12 391.5,-308.12"/>
<text xml:space="preserve" text-anchor="start" x="400.5" y="-320.97" font-family="Arial" font-weight="bold" font-size="12.00">Separation of Concerns</text>
<polygon fill="none" stroke="black" points="545.25,-308.12 545.25,-340.37 976.5,-340.37 976.5,-308.12 545.25,-308.12"/>
<text xml:space="preserve" text-anchor="start" x="554.25" y="-319.97" font-family="Arial" font-size="12.00">Gateway owns connection, Routes own forwardings, SSH manages primitives</text>
<polygon fill="none" stroke="black" points="391.5,-275.87 391.5,-308.12 545.25,-308.12 545.25,-275.87 391.5,-275.87"/>
<text xml:space="preserve" text-anchor="start" x="444.38" y="-288.72" font-family="Arial" font-weight="bold" font-size="12.00">Fail Fast</text>
<polygon fill="none" stroke="black" points="545.25,-275.87 545.25,-308.12 976.5,-308.12 976.5,-275.87 545.25,-275.87"/>
<text xml:space="preserve" text-anchor="start" x="574.88" y="-287.72" font-family="Arial" font-size="12.00">Synchronous validation, return errors immediately, let Kubernetes retry</text>
<polygon fill="none" stroke="black" points="391.5,-243.62 391.5,-275.87 545.25,-275.87 545.25,-243.62 391.5,-243.62"/>
<text xml:space="preserve" text-anchor="start" x="404.62" y="-256.47" font-family="Arial" font-weight="bold" font-size="12.00">Single Source of Truth</text>
<polygon fill="none" stroke="black" points="545.25,-243.62 545.25,-275.87 976.5,-275.87 976.5,-243.62 545.25,-243.62"/>
<text xml:space="preserve" text-anchor="start" x="564.38" y="-255.47" font-family="Arial" font-size="12.00">SSH Manager maintains authoritative state (forwardings + assignedAddrs)</text>
<polygon fill="none" stroke="black" points="391.5,-211.37 391.5,-243.62 545.25,-243.62 545.25,-211.37 391.5,-211.37"/>
<text xml:space="preserve" text-anchor="start" x="402.38" y="-224.22" font-family="Arial" font-weight="bold" font-size="12.00">Periodic Reconciliation</text>
<polygon fill="none" stroke="black" points="545.25,-211.37 545.25,-243.62 976.5,-243.62 976.5,-211.37 545.25,-211.37"/>
<text xml:space="preserve" text-anchor="start" x="579" y="-223.22" font-family="Arial" font-size="12.00">Routes (10s) validate forwardings, Gateway (30s) checks connection</text>
<polygon fill="none" stroke="black" points="391.5,-179.12 391.5,-211.37 545.25,-211.37 545.25,-179.12 391.5,-179.12"/>
<text xml:space="preserve" text-anchor="start" x="409.5" y="-191.97" font-family="Arial" font-weight="bold" font-size="12.00">Hostname Validation</text>
<polygon fill="none" stroke="black" points="545.25,-179.12 545.25,-211.37 976.5,-211.37 976.5,-179.12 545.25,-179.12"/>
<text xml:space="preserve" text-anchor="start" x="559.88" y="-190.97" font-family="Arial" font-size="12.00">SSH Manager validates assigned hostname matches request (fails if wrong)</text>
<polygon fill="none" stroke="black" points="391.5,-146.87 391.5,-179.12 545.25,-179.12 545.25,-146.87 391.5,-146.87"/>
<text xml:space="preserve" text-anchor="start" x="416.25" y="-159.72" font-family="Arial" font-weight="bold" font-size="12.00">State Consistency</text>
<polygon fill="none" stroke="black" points="545.25,-146.87 545.25,-179.12 976.5,-179.12 976.5,-146.87 545.25,-146.87"/>
<text xml:space="preserve" text-anchor="start" x="610.12" y="-158.72" font-family="Arial" font-size="12.00">forwardings and assignedAddrs always cleaned together</text>
<polygon fill="none" stroke="black" points="391.5,-114.62 391.5,-146.87 545.25,-146.87 545.25,-114.62 391.5,-114.62"/>
<text xml:space="preserve" text-anchor="start" x="415.88" y="-127.47" font-family="Arial" font-weight="bold" font-size="12.00">Concurrent Reads</text>
<polygon fill="none" stroke="black" points="545.25,-114.62 545.25,-146.87 976.5,-146.87 976.5,-114.62 545.25,-114.62"/>
<text xml:space="preserve" text-anchor="start" x="594.38" y="-126.47" font-family="Arial" font-size="12.00">GetAssignedAddresses uses RWMutex.RLock for performance</text>
</g>
</g>
</svg>
