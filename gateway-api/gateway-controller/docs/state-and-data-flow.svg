<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 14.0.4 (20251115.1723)
 -->
<!-- Title: StateAndDataFlow Pages: 1 -->
<svg width="3566pt" height="1693pt"
 viewBox="0.00 0.00 3566.00 1693.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1688.5)">
<title>StateAndDataFlow</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-1688.5 3561.75,-1688.5 3561.75,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_gateway_state</title>
<polygon fill="#c8e6c9" stroke="#c8e6c9" points="139.5,-8 139.5,-160 1059.5,-160 1059.5,-8 139.5,-8"/>
<text xml:space="preserve" text-anchor="middle" x="599.5" y="-142.7" font-family="Times,serif" font-size="14.00">Gateway Controller State</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_ssh_state</title>
<polygon fill="#ffe0b2" stroke="#ffe0b2" points="125.62,-175 125.62,-500 766.5,-500 766.5,-175 125.62,-175"/>
<text xml:space="preserve" text-anchor="middle" x="446.06" y="-482.7" font-family="Times,serif" font-size="14.00">SSH Manager State</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_scenario1</title>
<polygon fill="#e3f2fd" stroke="#e3f2fd" points="145.75,-518 145.75,-595 2829,-595 2829,-518 145.75,-518"/>
<text xml:space="preserve" text-anchor="middle" x="1487.38" y="-577.7" font-family="Times,serif" font-size="14.00">Scenario 1: Normal Route Setup</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_scenario2</title>
<polygon fill="#fff3e0" stroke="#fff3e0" points="153.25,-612 153.25,-701 3549.75,-701 3549.75,-612 153.25,-612"/>
<text xml:space="preserve" text-anchor="middle" x="1851.5" y="-683.7" font-family="Times,serif" font-size="14.00">Scenario 2: SSH Reconnect with Wrong Hostname</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_scenario3</title>
<polygon fill="#e8f5e9" stroke="#e8f5e9" points="151,-718 151,-795 1818.25,-795 1818.25,-718 151,-718"/>
<text xml:space="preserve" text-anchor="middle" x="984.62" y="-777.7" font-family="Times,serif" font-size="14.00">Scenario 3: Periodic Validation (Happy Path)</text>
</g>
<!-- gateways_map -->
<g id="node1" class="node">
<title>gateways_map</title>
<path fill="lightgrey" stroke="none" d="M273.5,-124.5C273.5,-124.5 159.5,-124.5 159.5,-124.5 153.5,-124.5 147.5,-118.5 147.5,-112.5 147.5,-112.5 147.5,-35.5 147.5,-35.5 147.5,-29.5 153.5,-23.5 159.5,-23.5 159.5,-23.5 273.5,-23.5 273.5,-23.5 279.5,-23.5 285.5,-29.5 285.5,-35.5 285.5,-35.5 285.5,-112.5 285.5,-112.5 285.5,-118.5 279.5,-124.5 273.5,-124.5"/>
<polygon fill="#a5d6a7" stroke="none" points="155.5,-93 155.5,-120.5 277.5,-120.5 277.5,-93 155.5,-93"/>
<polygon fill="none" stroke="black" points="155.5,-93 155.5,-120.5 277.5,-120.5 277.5,-93 155.5,-93"/>
<text xml:space="preserve" text-anchor="start" x="179.38" y="-104.05" font-family="Arial" font-weight="bold" font-size="11.00">gateways map</text>
<polygon fill="none" stroke="black" points="155.5,-52 155.5,-93 277.5,-93 277.5,-52 155.5,-52"/>
<text xml:space="preserve" text-anchor="start" x="162.5" y="-75.55" font-family="Arial" font-size="11.00">key: namespace/name</text>
<text xml:space="preserve" text-anchor="start" x="164.75" y="-62.05" font-family="Arial" font-size="11.00">value: Gateway struct</text>
<polygon fill="none" stroke="black" points="155.5,-27.5 155.5,-52 277.5,-52 277.5,-27.5 155.5,-27.5"/>
<text xml:space="preserve" text-anchor="start" x="162.88" y="-36.45" font-family="Arial" font-size="9.00">Protected by: gatewaysMu</text>
</g>
<!-- listeners_map -->
<g id="node2" class="node">
<title>listeners_map</title>
<path fill="lightgrey" stroke="none" d="M721.38,-124.5C721.38,-124.5 612.62,-124.5 612.62,-124.5 606.62,-124.5 600.62,-118.5 600.62,-112.5 600.62,-112.5 600.62,-35.5 600.62,-35.5 600.62,-29.5 606.62,-23.5 612.62,-23.5 612.62,-23.5 721.38,-23.5 721.38,-23.5 727.38,-23.5 733.38,-29.5 733.38,-35.5 733.38,-35.5 733.38,-112.5 733.38,-112.5 733.38,-118.5 727.38,-124.5 721.38,-124.5"/>
<polygon fill="#a5d6a7" stroke="none" points="608.62,-93 608.62,-120.5 725.38,-120.5 725.38,-93 608.62,-93"/>
<polygon fill="none" stroke="black" points="608.62,-93 608.62,-120.5 725.38,-120.5 725.38,-93 608.62,-93"/>
<text xml:space="preserve" text-anchor="start" x="631.75" y="-104.05" font-family="Arial" font-weight="bold" font-size="11.00">listeners map</text>
<polygon fill="none" stroke="black" points="608.62,-52 608.62,-93 725.38,-93 725.38,-52 608.62,-52"/>
<text xml:space="preserve" text-anchor="start" x="623.5" y="-75.55" font-family="Arial" font-size="11.00">key: listener name</text>
<text xml:space="preserve" text-anchor="start" x="617.5" y="-62.05" font-family="Arial" font-size="11.00">value: Listener struct</text>
<polygon fill="none" stroke="black" points="608.62,-27.5 608.62,-52 725.38,-52 725.38,-27.5 608.62,-27.5"/>
<text xml:space="preserve" text-anchor="start" x="615.62" y="-36.45" font-family="Arial" font-size="9.00">Protected by: listenersMu</text>
</g>
<!-- gateways_map&#45;&gt;listeners_map -->
<g id="edge1" class="edge">
<title>gateways_map&#45;&gt;listeners_map</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M285.41,-74C285.41,-74 589.15,-74 589.15,-74"/>
<polygon fill="black" stroke="black" points="589.15,-77.5 599.15,-74 589.15,-70.5 589.15,-77.5"/>
<text xml:space="preserve" text-anchor="middle" x="504.25" y="-75.95" font-family="Arial" font-size="9.00">contains</text>
</g>
<!-- route_state -->
<g id="node3" class="node">
<title>route_state</title>
<path fill="lightgrey" stroke="none" d="M1039.5,-127.75C1039.5,-127.75 914.25,-127.75 914.25,-127.75 908.25,-127.75 902.25,-121.75 902.25,-115.75 902.25,-115.75 902.25,-28.25 902.25,-28.25 902.25,-22.25 908.25,-16.25 914.25,-16.25 914.25,-16.25 1039.5,-16.25 1039.5,-16.25 1045.5,-16.25 1051.5,-22.25 1051.5,-28.25 1051.5,-28.25 1051.5,-115.75 1051.5,-115.75 1051.5,-121.75 1045.5,-127.75 1039.5,-127.75"/>
<polygon fill="#a5d6a7" stroke="none" points="910.25,-96.25 910.25,-123.75 1043.5,-123.75 1043.5,-96.25 910.25,-96.25"/>
<polygon fill="none" stroke="black" points="910.25,-96.25 910.25,-123.75 1043.5,-123.75 1043.5,-96.25 910.25,-96.25"/>
<text xml:space="preserve" text-anchor="start" x="917.25" y="-107.3" font-family="Arial" font-weight="bold" font-size="11.00">route field (in Listener)</text>
<polygon fill="none" stroke="black" points="910.25,-55.25 910.25,-96.25 1043.5,-96.25 1043.5,-55.25 910.25,-55.25"/>
<text xml:space="preserve" text-anchor="start" x="927" y="-78.8" font-family="Arial" font-size="11.00">• Name, Namespace</text>
<text xml:space="preserve" text-anchor="start" x="928.12" y="-65.3" font-family="Arial" font-size="11.00">• Backend Host:Port</text>
<polygon fill="none" stroke="black" points="910.25,-20.25 910.25,-55.25 1043.5,-55.25 1043.5,-20.25 910.25,-20.25"/>
<text xml:space="preserve" text-anchor="start" x="931.5" y="-39.7" font-family="Arial" font-size="9.00">nil = no route attached</text>
<text xml:space="preserve" text-anchor="start" x="928.5" y="-29.2" font-family="Arial" font-size="9.00">non&#45;nil = route attached</text>
</g>
<!-- listeners_map&#45;&gt;route_state -->
<g id="edge2" class="edge">
<title>listeners_map&#45;&gt;route_state</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M733.1,-74C733.1,-74 890.94,-74 890.94,-74"/>
<polygon fill="black" stroke="black" points="890.94,-77.5 900.94,-74 890.94,-70.5 890.94,-77.5"/>
<text xml:space="preserve" text-anchor="middle" x="829.75" y="-75.95" font-family="Arial" font-size="9.00">contains</text>
</g>
<!-- forwardings_map -->
<g id="node4" class="node">
<title>forwardings_map</title>
<path fill="lightgrey" stroke="none" d="M287.38,-308.75C287.38,-308.75 145.62,-308.75 145.62,-308.75 139.62,-308.75 133.62,-302.75 133.62,-296.75 133.62,-296.75 133.62,-195.25 133.62,-195.25 133.62,-189.25 139.62,-183.25 145.62,-183.25 145.62,-183.25 287.38,-183.25 287.38,-183.25 293.38,-183.25 299.38,-189.25 299.38,-195.25 299.38,-195.25 299.38,-296.75 299.38,-296.75 299.38,-302.75 293.38,-308.75 287.38,-308.75"/>
<polygon fill="#ffcc80" stroke="none" points="141.62,-277.25 141.62,-304.75 291.38,-304.75 291.38,-277.25 141.62,-277.25"/>
<polygon fill="none" stroke="black" points="141.62,-277.25 141.62,-304.75 291.38,-304.75 291.38,-277.25 141.62,-277.25"/>
<text xml:space="preserve" text-anchor="start" x="172.25" y="-288.3" font-family="Arial" font-weight="bold" font-size="11.00">forwardings map</text>
<polygon fill="none" stroke="black" points="141.62,-236.25 141.62,-277.25 291.38,-277.25 291.38,-236.25 141.62,-236.25"/>
<text xml:space="preserve" text-anchor="start" x="148.62" y="-259.8" font-family="Arial" font-size="11.00">key: remoteHost:remotePort</text>
<text xml:space="preserve" text-anchor="start" x="157.62" y="-246.3" font-family="Arial" font-size="11.00">value: ForwardingConfig</text>
<polygon fill="none" stroke="black" points="141.62,-211.75 141.62,-236.25 291.38,-236.25 291.38,-211.75 141.62,-211.75"/>
<text xml:space="preserve" text-anchor="start" x="169.62" y="-220.7" font-family="Arial" font-size="9.00">What we REQUESTED</text>
<polygon fill="none" stroke="black" points="141.62,-187.25 141.62,-211.75 291.38,-211.75 291.38,-187.25 141.62,-187.25"/>
<text xml:space="preserve" text-anchor="start" x="171.5" y="-196.2" font-family="Arial" font-size="9.00">Protected by: clientMu</text>
</g>
<!-- assigned_map -->
<g id="node5" class="node">
<title>assigned_map</title>
<path fill="lightgrey" stroke="none" d="M746.5,-319C746.5,-319 587.5,-319 587.5,-319 581.5,-319 575.5,-313 575.5,-307 575.5,-307 575.5,-195 575.5,-195 575.5,-189 581.5,-183 587.5,-183 587.5,-183 746.5,-183 746.5,-183 752.5,-183 758.5,-189 758.5,-195 758.5,-195 758.5,-307 758.5,-307 758.5,-313 752.5,-319 746.5,-319"/>
<polygon fill="#ffcc80" stroke="none" points="583.5,-287.5 583.5,-315 750.5,-315 750.5,-287.5 583.5,-287.5"/>
<polygon fill="none" stroke="black" points="583.5,-287.5 583.5,-315 750.5,-315 750.5,-287.5 583.5,-287.5"/>
<text xml:space="preserve" text-anchor="start" x="614.5" y="-298.55" font-family="Arial" font-weight="bold" font-size="11.00">assignedAddrs map</text>
<polygon fill="none" stroke="black" points="583.5,-246.5 583.5,-287.5 750.5,-287.5 750.5,-246.5 583.5,-246.5"/>
<text xml:space="preserve" text-anchor="start" x="599.12" y="-270.05" font-family="Arial" font-size="11.00">key: remoteHost:remotePort</text>
<text xml:space="preserve" text-anchor="start" x="617.5" y="-256.55" font-family="Arial" font-size="11.00">value: []string (URIs)</text>
<polygon fill="none" stroke="black" points="583.5,-211.5 583.5,-246.5 750.5,-246.5 750.5,-211.5 583.5,-211.5"/>
<text xml:space="preserve" text-anchor="start" x="618.25" y="-230.95" font-family="Arial" font-size="9.00">What server ASSIGNED</text>
<text xml:space="preserve" text-anchor="start" x="618.62" y="-220.45" font-family="Arial" font-size="9.00">e.g., [&quot;http://xyz.tuns.sh&quot;]</text>
<polygon fill="none" stroke="black" points="583.5,-187 583.5,-211.5 750.5,-211.5 750.5,-187 583.5,-187"/>
<text xml:space="preserve" text-anchor="start" x="590.5" y="-195.95" font-family="Arial" font-size="9.00">Protected by: addrNotifMu (RWMutex)</text>
</g>
<!-- forwardings_map&#45;&gt;assigned_map -->
<g id="edge3" class="edge">
<title>forwardings_map&#45;&gt;assigned_map</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M310.64,-246C310.64,-246 564.08,-246 564.08,-246"/>
<polygon fill="black" stroke="black" points="310.64,-242.5 300.64,-246 310.64,-249.5 310.64,-242.5"/>
<polygon fill="black" stroke="black" points="564.08,-249.5 574.08,-246 564.08,-242.5 564.08,-249.5"/>
<text xml:space="preserve" text-anchor="middle" x="504.25" y="-249.95" font-family="Arial" font-size="9.00">paired</text>
</g>
<!-- ssh_client -->
<g id="node6" class="node">
<title>ssh_client</title>
<path fill="lightgrey" stroke="none" d="M267.5,-467.5C267.5,-467.5 165.5,-467.5 165.5,-467.5 159.5,-467.5 153.5,-461.5 153.5,-455.5 153.5,-455.5 153.5,-378.5 153.5,-378.5 153.5,-372.5 159.5,-366.5 165.5,-366.5 165.5,-366.5 267.5,-366.5 267.5,-366.5 273.5,-366.5 279.5,-372.5 279.5,-378.5 279.5,-378.5 279.5,-455.5 279.5,-455.5 279.5,-461.5 273.5,-467.5 267.5,-467.5"/>
<polygon fill="#ffcc80" stroke="none" points="161.5,-436 161.5,-463.5 271.5,-463.5 271.5,-436 161.5,-436"/>
<polygon fill="none" stroke="black" points="161.5,-436 161.5,-463.5 271.5,-463.5 271.5,-436 161.5,-436"/>
<text xml:space="preserve" text-anchor="start" x="168.5" y="-447.05" font-family="Arial" font-weight="bold" font-size="11.00">client (*ssh.Client)</text>
<polygon fill="none" stroke="black" points="161.5,-395 161.5,-436 271.5,-436 271.5,-395 161.5,-395"/>
<text xml:space="preserve" text-anchor="start" x="173.38" y="-418.55" font-family="Arial" font-size="11.00">nil = disconnected</text>
<text xml:space="preserve" text-anchor="start" x="169.25" y="-405.05" font-family="Arial" font-size="11.00">non&#45;nil = connected</text>
<polygon fill="none" stroke="black" points="161.5,-370.5 161.5,-395 271.5,-395 271.5,-370.5 161.5,-370.5"/>
<text xml:space="preserve" text-anchor="start" x="171.5" y="-379.45" font-family="Arial" font-size="9.00">Protected by: clientMu</text>
</g>
<!-- s1_1 -->
<g id="node7" class="node">
<title>s1_1</title>
<path fill="#bbdefb" stroke="black" d="M267.25,-562C267.25,-562 165.75,-562 165.75,-562 159.75,-562 153.75,-556 153.75,-550 153.75,-550 153.75,-538 153.75,-538 153.75,-532 159.75,-526 165.75,-526 165.75,-526 267.25,-526 267.25,-526 273.25,-526 279.25,-532 279.25,-538 279.25,-538 279.25,-550 279.25,-550 279.25,-556 273.25,-562 267.25,-562"/>
<text xml:space="preserve" text-anchor="middle" x="216.5" y="-547.05" font-family="Arial" font-size="11.00">1. HTTPRoute created</text>
<text xml:space="preserve" text-anchor="middle" x="216.5" y="-533.55" font-family="Arial" font-size="11.00">in Kubernetes</text>
</g>
<!-- s1_2 -->
<g id="node8" class="node">
<title>s1_2</title>
<path fill="#bbdefb" stroke="black" d="M727.12,-562C727.12,-562 606.88,-562 606.88,-562 600.88,-562 594.88,-556 594.88,-550 594.88,-550 594.88,-538 594.88,-538 594.88,-532 600.88,-526 606.88,-526 606.88,-526 727.12,-526 727.12,-526 733.12,-526 739.12,-532 739.12,-538 739.12,-538 739.12,-550 739.12,-550 739.12,-556 733.12,-562 727.12,-562"/>
<text xml:space="preserve" text-anchor="middle" x="667" y="-547.05" font-family="Arial" font-size="11.00">2. HTTPRoute.Reconcile()</text>
<text xml:space="preserve" text-anchor="middle" x="667" y="-533.55" font-family="Arial" font-size="11.00">triggers</text>
</g>
<!-- s1_1&#45;&gt;s1_2 -->
<g id="edge4" class="edge">
<title>s1_1&#45;&gt;s1_2</title>
<path fill="none" stroke="black" d="M279.61,-544C279.61,-544 583.12,-544 583.12,-544"/>
<polygon fill="black" stroke="black" points="583.12,-547.5 593.12,-544 583.12,-540.5 583.12,-547.5"/>
</g>
<!-- s1_3 -->
<g id="node9" class="node">
<title>s1_3</title>
<path fill="#90caf9" stroke="black" d="M1031.38,-562C1031.38,-562 922.38,-562 922.38,-562 916.38,-562 910.38,-556 910.38,-550 910.38,-550 910.38,-538 910.38,-538 910.38,-532 916.38,-526 922.38,-526 922.38,-526 1031.38,-526 1031.38,-526 1037.38,-526 1043.38,-532 1043.38,-538 1043.38,-538 1043.38,-550 1043.38,-550 1043.38,-556 1037.38,-562 1031.38,-562"/>
<text xml:space="preserve" text-anchor="middle" x="976.88" y="-547.05" font-family="Arial" font-size="11.00">3. GW.SetRoute() called</text>
<text xml:space="preserve" text-anchor="middle" x="976.88" y="-533.55" font-family="Arial" font-size="11.00">with route details</text>
</g>
<!-- s1_2&#45;&gt;s1_3 -->
<g id="edge5" class="edge">
<title>s1_2&#45;&gt;s1_3</title>
<path fill="none" stroke="black" d="M739.26,-544C739.26,-544 898.55,-544 898.55,-544"/>
<polygon fill="black" stroke="black" points="898.55,-547.5 908.55,-544 898.55,-540.5 898.55,-547.5"/>
</g>
<!-- s1_4 -->
<g id="node10" class="node">
<title>s1_4</title>
<path fill="#90caf9" stroke="black" d="M1307.12,-562C1307.12,-562 1176.38,-562 1176.38,-562 1170.38,-562 1164.38,-556 1164.38,-550 1164.38,-550 1164.38,-538 1164.38,-538 1164.38,-532 1170.38,-526 1176.38,-526 1176.38,-526 1307.12,-526 1307.12,-526 1313.12,-526 1319.12,-532 1319.12,-538 1319.12,-538 1319.12,-550 1319.12,-550 1319.12,-556 1313.12,-562 1307.12,-562"/>
<text xml:space="preserve" text-anchor="middle" x="1241.75" y="-547.05" font-family="Arial" font-size="11.00">4. Check isForwardingValid()</text>
<text xml:space="preserve" text-anchor="middle" x="1241.75" y="-533.55" font-family="Arial" font-size="11.00">returns false (new route)</text>
</g>
<!-- s1_3&#45;&gt;s1_4 -->
<g id="edge6" class="edge">
<title>s1_3&#45;&gt;s1_4</title>
<path fill="none" stroke="black" d="M1043.71,-544C1043.71,-544 1152.61,-544 1152.61,-544"/>
<polygon fill="black" stroke="black" points="1152.61,-547.5 1162.61,-544 1152.61,-540.5 1152.61,-547.5"/>
</g>
<!-- s1_5 -->
<g id="node11" class="node">
<title>s1_5</title>
<path fill="#ffb74d" stroke="black" d="M1558.5,-562C1558.5,-562 1442.75,-562 1442.75,-562 1436.75,-562 1430.75,-556 1430.75,-550 1430.75,-550 1430.75,-538 1430.75,-538 1430.75,-532 1436.75,-526 1442.75,-526 1442.75,-526 1558.5,-526 1558.5,-526 1564.5,-526 1570.5,-532 1570.5,-538 1570.5,-538 1570.5,-550 1570.5,-550 1570.5,-556 1564.5,-562 1558.5,-562"/>
<text xml:space="preserve" text-anchor="middle" x="1500.62" y="-547.05" font-family="Arial" font-size="11.00">5. SSH.StartForwarding()</text>
<text xml:space="preserve" text-anchor="middle" x="1500.62" y="-533.55" font-family="Arial" font-size="11.00">called</text>
</g>
<!-- s1_4&#45;&gt;s1_5 -->
<g id="edge7" class="edge">
<title>s1_4&#45;&gt;s1_5</title>
<path fill="none" stroke="black" d="M1319.42,-544C1319.42,-544 1418.99,-544 1418.99,-544"/>
<polygon fill="black" stroke="black" points="1418.99,-547.5 1428.99,-544 1418.99,-540.5 1418.99,-547.5"/>
</g>
<!-- s1_6 -->
<g id="node12" class="node">
<title>s1_6</title>
<path fill="#ffb74d" stroke="black" d="M1809.5,-562C1809.5,-562 1691.5,-562 1691.5,-562 1685.5,-562 1679.5,-556 1679.5,-550 1679.5,-550 1679.5,-538 1679.5,-538 1679.5,-532 1685.5,-526 1691.5,-526 1691.5,-526 1809.5,-526 1809.5,-526 1815.5,-526 1821.5,-532 1821.5,-538 1821.5,-538 1821.5,-550 1821.5,-550 1821.5,-556 1815.5,-562 1809.5,-562"/>
<text xml:space="preserve" text-anchor="middle" x="1750.5" y="-547.05" font-family="Arial" font-size="11.00">6. Add to forwardings map</text>
<text xml:space="preserve" text-anchor="middle" x="1750.5" y="-533.55" font-family="Arial" font-size="11.00">wait for assignedAddrs</text>
</g>
<!-- s1_5&#45;&gt;s1_6 -->
<g id="edge8" class="edge">
<title>s1_5&#45;&gt;s1_6</title>
<path fill="none" stroke="black" d="M1570.89,-544C1570.89,-544 1667.51,-544 1667.51,-544"/>
<polygon fill="black" stroke="black" points="1667.51,-547.5 1677.51,-544 1667.51,-540.5 1667.51,-547.5"/>
</g>
<!-- s1_7 -->
<g id="node13" class="node">
<title>s1_7</title>
<path fill="#ffb74d" stroke="black" d="M2042.88,-562C2042.88,-562 1957.88,-562 1957.88,-562 1951.88,-562 1945.88,-556 1945.88,-550 1945.88,-550 1945.88,-538 1945.88,-538 1945.88,-532 1951.88,-526 1957.88,-526 1957.88,-526 2042.88,-526 2042.88,-526 2048.88,-526 2054.88,-532 2054.88,-538 2054.88,-538 2054.88,-550 2054.88,-550 2054.88,-556 2048.88,-562 2042.88,-562"/>
<text xml:space="preserve" text-anchor="middle" x="2000.38" y="-547.05" font-family="Arial" font-size="11.00">7. Server responds</text>
<text xml:space="preserve" text-anchor="middle" x="2000.38" y="-533.55" font-family="Arial" font-size="11.00">with assigned URIs</text>
</g>
<!-- s1_6&#45;&gt;s1_7 -->
<g id="edge9" class="edge">
<title>s1_6&#45;&gt;s1_7</title>
<path fill="none" stroke="black" d="M1821.77,-544C1821.77,-544 1934.18,-544 1934.18,-544"/>
<polygon fill="black" stroke="black" points="1934.18,-547.5 1944.18,-544 1934.18,-540.5 1934.18,-547.5"/>
</g>
<!-- s1_8 -->
<g id="node14" class="node">
<title>s1_8</title>
<path fill="#ffb74d" stroke="black" d="M2316,-562C2316,-562 2191.25,-562 2191.25,-562 2185.25,-562 2179.25,-556 2179.25,-550 2179.25,-550 2179.25,-538 2179.25,-538 2179.25,-532 2185.25,-526 2191.25,-526 2191.25,-526 2316,-526 2316,-526 2322,-526 2328,-532 2328,-538 2328,-538 2328,-550 2328,-550 2328,-556 2322,-562 2316,-562"/>
<text xml:space="preserve" text-anchor="middle" x="2253.62" y="-547.05" font-family="Arial" font-size="11.00">8. Validate hostname match</text>
<text xml:space="preserve" text-anchor="middle" x="2253.62" y="-533.55" font-family="Arial" font-size="11.00">update assignedAddrs</text>
</g>
<!-- s1_7&#45;&gt;s1_8 -->
<g id="edge10" class="edge">
<title>s1_7&#45;&gt;s1_8</title>
<path fill="none" stroke="black" d="M2055.33,-544C2055.33,-544 2167.57,-544 2167.57,-544"/>
<polygon fill="black" stroke="black" points="2167.57,-547.5 2177.57,-544 2167.57,-540.5 2167.57,-547.5"/>
</g>
<!-- s1_9 -->
<g id="node15" class="node">
<title>s1_9</title>
<path fill="#90caf9" stroke="black" d="M2552.75,-562C2552.75,-562 2449,-562 2449,-562 2443,-562 2437,-556 2437,-550 2437,-550 2437,-538 2437,-538 2437,-532 2443,-526 2449,-526 2449,-526 2552.75,-526 2552.75,-526 2558.75,-526 2564.75,-532 2564.75,-538 2564.75,-538 2564.75,-550 2564.75,-550 2564.75,-556 2558.75,-562 2552.75,-562"/>
<text xml:space="preserve" text-anchor="middle" x="2500.88" y="-547.05" font-family="Arial" font-size="11.00">9. Update listener.route</text>
<text xml:space="preserve" text-anchor="middle" x="2500.88" y="-533.55" font-family="Arial" font-size="11.00">in controller state</text>
</g>
<!-- s1_8&#45;&gt;s1_9 -->
<g id="edge11" class="edge">
<title>s1_8&#45;&gt;s1_9</title>
<path fill="none" stroke="black" d="M2328.48,-544C2328.48,-544 2425.2,-544 2425.2,-544"/>
<polygon fill="black" stroke="black" points="2425.2,-547.5 2435.2,-544 2425.2,-540.5 2425.2,-547.5"/>
</g>
<!-- s1_10 -->
<g id="node16" class="node">
<title>s1_10</title>
<path fill="#90caf9" stroke="black" d="M2809,-562C2809,-562 2687.25,-562 2687.25,-562 2681.25,-562 2675.25,-556 2675.25,-550 2675.25,-550 2675.25,-538 2675.25,-538 2675.25,-532 2681.25,-526 2687.25,-526 2687.25,-526 2809,-526 2809,-526 2815,-526 2821,-532 2821,-538 2821,-538 2821,-550 2821,-550 2821,-556 2815,-562 2809,-562"/>
<text xml:space="preserve" text-anchor="middle" x="2748.12" y="-547.05" font-family="Arial" font-size="11.00">10. Update Gateway.status</text>
<text xml:space="preserve" text-anchor="middle" x="2748.12" y="-533.55" font-family="Arial" font-size="11.00">in Kubernetes</text>
</g>
<!-- s1_9&#45;&gt;s1_10 -->
<g id="edge12" class="edge">
<title>s1_9&#45;&gt;s1_10</title>
<path fill="none" stroke="black" d="M2565.19,-544C2565.19,-544 2663.44,-544 2663.44,-544"/>
<polygon fill="black" stroke="black" points="2663.44,-547.5 2673.44,-544 2663.44,-540.5 2663.44,-547.5"/>
</g>
<!-- s2_1 -->
<g id="node17" class="node">
<title>s2_1</title>
<path fill="#ffe0b2" stroke="black" d="M259.75,-662C259.75,-662 173.25,-662 173.25,-662 167.25,-662 161.25,-656 161.25,-650 161.25,-650 161.25,-638 161.25,-638 161.25,-632 167.25,-626 173.25,-626 173.25,-626 259.75,-626 259.75,-626 265.75,-626 271.75,-632 271.75,-638 271.75,-638 271.75,-650 271.75,-650 271.75,-656 265.75,-662 259.75,-662"/>
<text xml:space="preserve" text-anchor="middle" x="216.5" y="-647.05" font-family="Arial" font-size="11.00">1. SSH disconnects</text>
<text xml:space="preserve" text-anchor="middle" x="216.5" y="-633.55" font-family="Arial" font-size="11.00">(network issue)</text>
</g>
<!-- s2_2 -->
<g id="node18" class="node">
<title>s2_2</title>
<path fill="#ffcc80" stroke="black" d="M712.12,-668.25C712.12,-668.25 621.88,-668.25 621.88,-668.25 615.88,-668.25 609.88,-662.25 609.88,-656.25 609.88,-656.25 609.88,-631.75 609.88,-631.75 609.88,-625.75 615.88,-619.75 621.88,-619.75 621.88,-619.75 712.12,-619.75 712.12,-619.75 718.12,-619.75 724.12,-625.75 724.12,-631.75 724.12,-631.75 724.12,-656.25 724.12,-656.25 724.12,-662.25 718.12,-668.25 712.12,-668.25"/>
<text xml:space="preserve" text-anchor="middle" x="667" y="-653.8" font-family="Arial" font-size="11.00">2. SSH.closeClient()</text>
<text xml:space="preserve" text-anchor="middle" x="667" y="-640.3" font-family="Arial" font-size="11.00">clears forwardings +</text>
<text xml:space="preserve" text-anchor="middle" x="667" y="-626.8" font-family="Arial" font-size="11.00">assignedAddrs</text>
</g>
<!-- s2_1&#45;&gt;s2_2 -->
<g id="edge13" class="edge">
<title>s2_1&#45;&gt;s2_2</title>
<path fill="none" stroke="black" d="M272.19,-644C272.19,-644 598.15,-644 598.15,-644"/>
<polygon fill="black" stroke="black" points="598.15,-647.5 608.15,-644 598.15,-640.5 598.15,-647.5"/>
</g>
<!-- s2_3 -->
<g id="node19" class="node">
<title>s2_3</title>
<polygon fill="#ffe082" stroke="black" stroke-dasharray="5,2" points="1042.25,-662 911.5,-662 911.5,-626 1042.25,-626 1042.25,-662"/>
<text xml:space="preserve" text-anchor="middle" x="976.88" y="-647.05" font-family="Arial" font-size="11.00">3. listener.route remains</text>
<text xml:space="preserve" text-anchor="middle" x="976.88" y="-633.55" font-family="Arial" font-size="11.00">(stale state)</text>
</g>
<!-- s2_2&#45;&gt;s2_3 -->
<g id="edge14" class="edge">
<title>s2_2&#45;&gt;s2_3</title>
<path fill="none" stroke="black" d="M724.56,-644C724.56,-644 899.52,-644 899.52,-644"/>
<polygon fill="black" stroke="black" points="899.52,-647.5 909.52,-644 899.52,-640.5 899.52,-647.5"/>
</g>
<!-- s2_4 -->
<g id="node20" class="node">
<title>s2_4</title>
<path fill="#a5d6a7" stroke="black" d="M1293.62,-662C1293.62,-662 1189.88,-662 1189.88,-662 1183.88,-662 1177.88,-656 1177.88,-650 1177.88,-650 1177.88,-638 1177.88,-638 1177.88,-632 1183.88,-626 1189.88,-626 1189.88,-626 1293.62,-626 1293.62,-626 1299.62,-626 1305.62,-632 1305.62,-638 1305.62,-638 1305.62,-650 1305.62,-650 1305.62,-656 1299.62,-662 1293.62,-662"/>
<text xml:space="preserve" text-anchor="middle" x="1241.75" y="-647.05" font-family="Arial" font-size="11.00">4. Gateway.Reconcile()</text>
<text xml:space="preserve" text-anchor="middle" x="1241.75" y="-633.55" font-family="Arial" font-size="11.00">detects disconnect</text>
</g>
<!-- s2_3&#45;&gt;s2_4 -->
<g id="edge15" class="edge">
<title>s2_3&#45;&gt;s2_4</title>
<path fill="none" stroke="black" d="M1042.69,-644C1042.69,-644 1166.13,-644 1166.13,-644"/>
<polygon fill="black" stroke="black" points="1166.13,-647.5 1176.13,-644 1166.13,-640.5 1166.13,-647.5"/>
</g>
<!-- s2_5 -->
<g id="node21" class="node">
<title>s2_5</title>
<path fill="#ffcc80" stroke="black" d="M1536,-662C1536,-662 1465.25,-662 1465.25,-662 1459.25,-662 1453.25,-656 1453.25,-650 1453.25,-650 1453.25,-638 1453.25,-638 1453.25,-632 1459.25,-626 1465.25,-626 1465.25,-626 1536,-626 1536,-626 1542,-626 1548,-632 1548,-638 1548,-638 1548,-650 1548,-650 1548,-656 1542,-662 1536,-662"/>
<text xml:space="preserve" text-anchor="middle" x="1500.62" y="-647.05" font-family="Arial" font-size="11.00">5. Gateway calls</text>
<text xml:space="preserve" text-anchor="middle" x="1500.62" y="-633.55" font-family="Arial" font-size="11.00">SSH.Connect()</text>
</g>
<!-- s2_4&#45;&gt;s2_5 -->
<g id="edge16" class="edge">
<title>s2_4&#45;&gt;s2_5</title>
<path fill="none" stroke="black" d="M1306.07,-644C1306.07,-644 1441.41,-644 1441.41,-644"/>
<polygon fill="black" stroke="black" points="1441.41,-647.5 1451.41,-644 1441.41,-640.5 1441.41,-647.5"/>
</g>
<!-- s2_6 -->
<g id="node22" class="node">
<title>s2_6</title>
<path fill="#90caf9" stroke="black" d="M1796,-662C1796,-662 1705,-662 1705,-662 1699,-662 1693,-656 1693,-650 1693,-650 1693,-638 1693,-638 1693,-632 1699,-626 1705,-626 1705,-626 1796,-626 1796,-626 1802,-626 1808,-632 1808,-638 1808,-638 1808,-650 1808,-650 1808,-656 1802,-662 1796,-662"/>
<text xml:space="preserve" text-anchor="middle" x="1750.5" y="-647.05" font-family="Arial" font-size="11.00">6. Route.Reconcile()</text>
<text xml:space="preserve" text-anchor="middle" x="1750.5" y="-633.55" font-family="Arial" font-size="11.00">triggers (0&#45;10s)</text>
</g>
<!-- s2_5&#45;&gt;s2_6 -->
<g id="edge17" class="edge">
<title>s2_5&#45;&gt;s2_6</title>
<path fill="none" stroke="black" d="M1548.21,-644C1548.21,-644 1681.03,-644 1681.03,-644"/>
<polygon fill="black" stroke="black" points="1681.03,-647.5 1691.03,-644 1681.03,-640.5 1681.03,-647.5"/>
</g>
<!-- s2_7 -->
<g id="node23" class="node">
<title>s2_7</title>
<path fill="#90caf9" stroke="black" d="M2058.25,-662C2058.25,-662 1942.5,-662 1942.5,-662 1936.5,-662 1930.5,-656 1930.5,-650 1930.5,-650 1930.5,-638 1930.5,-638 1930.5,-632 1936.5,-626 1942.5,-626 1942.5,-626 2058.25,-626 2058.25,-626 2064.25,-626 2070.25,-632 2070.25,-638 2070.25,-638 2070.25,-650 2070.25,-650 2070.25,-656 2064.25,-662 2058.25,-662"/>
<text xml:space="preserve" text-anchor="middle" x="2000.38" y="-647.05" font-family="Arial" font-size="11.00">7. GW.SetRoute() called</text>
<text xml:space="preserve" text-anchor="middle" x="2000.38" y="-633.55" font-family="Arial" font-size="11.00">isForwardingValid() check</text>
</g>
<!-- s2_6&#45;&gt;s2_7 -->
<g id="edge18" class="edge">
<title>s2_6&#45;&gt;s2_7</title>
<path fill="none" stroke="black" d="M1808.45,-644C1808.45,-644 1918.76,-644 1918.76,-644"/>
<polygon fill="black" stroke="black" points="1918.76,-647.5 1928.76,-644 1918.76,-640.5 1918.76,-647.5"/>
</g>
<!-- s2_8 -->
<g id="node24" class="node">
<title>s2_8</title>
<path fill="#ffb74d" stroke="black" d="M2315.62,-662C2315.62,-662 2191.62,-662 2191.62,-662 2185.62,-662 2179.62,-656 2179.62,-650 2179.62,-650 2179.62,-638 2179.62,-638 2179.62,-632 2185.62,-626 2191.62,-626 2191.62,-626 2315.62,-626 2315.62,-626 2321.62,-626 2327.62,-632 2327.62,-638 2327.62,-638 2327.62,-650 2327.62,-650 2327.62,-656 2321.62,-662 2315.62,-662"/>
<text xml:space="preserve" text-anchor="middle" x="2253.62" y="-647.05" font-family="Arial" font-size="11.00">8. GetAssignedAddresses()</text>
<text xml:space="preserve" text-anchor="middle" x="2253.62" y="-633.55" font-family="Arial" font-size="11.00">returns nil</text>
</g>
<!-- s2_7&#45;&gt;s2_8 -->
<g id="edge19" class="edge">
<title>s2_7&#45;&gt;s2_8</title>
<path fill="none" stroke="black" d="M2070.58,-644C2070.58,-644 2167.78,-644 2167.78,-644"/>
<polygon fill="black" stroke="black" points="2167.78,-647.5 2177.78,-644 2167.78,-640.5 2167.78,-647.5"/>
</g>
<!-- s2_9 -->
<g id="node25" class="node">
<title>s2_9</title>
<path fill="#90caf9" stroke="black" d="M2548.25,-662C2548.25,-662 2453.5,-662 2453.5,-662 2447.5,-662 2441.5,-656 2441.5,-650 2441.5,-650 2441.5,-638 2441.5,-638 2441.5,-632 2447.5,-626 2453.5,-626 2453.5,-626 2548.25,-626 2548.25,-626 2554.25,-626 2560.25,-632 2560.25,-638 2560.25,-638 2560.25,-650 2560.25,-650 2560.25,-656 2554.25,-662 2548.25,-662"/>
<text xml:space="preserve" text-anchor="middle" x="2500.88" y="-647.05" font-family="Arial" font-size="11.00">9. Clear listener.route</text>
<text xml:space="preserve" text-anchor="middle" x="2500.88" y="-633.55" font-family="Arial" font-size="11.00">(detect stale)</text>
</g>
<!-- s2_8&#45;&gt;s2_9 -->
<g id="edge20" class="edge">
<title>s2_8&#45;&gt;s2_9</title>
<path fill="none" stroke="black" d="M2327.81,-644C2327.81,-644 2429.74,-644 2429.74,-644"/>
<polygon fill="black" stroke="black" points="2429.74,-647.5 2439.74,-644 2429.74,-640.5 2429.74,-647.5"/>
</g>
<!-- s2_10 -->
<g id="node26" class="node">
<title>s2_10</title>
<path fill="#ffb74d" stroke="black" d="M2810.5,-662C2810.5,-662 2685.75,-662 2685.75,-662 2679.75,-662 2673.75,-656 2673.75,-650 2673.75,-650 2673.75,-638 2673.75,-638 2673.75,-632 2679.75,-626 2685.75,-626 2685.75,-626 2810.5,-626 2810.5,-626 2816.5,-626 2822.5,-632 2822.5,-638 2822.5,-638 2822.5,-650 2822.5,-650 2822.5,-656 2816.5,-662 2810.5,-662"/>
<text xml:space="preserve" text-anchor="middle" x="2748.12" y="-640.3" font-family="Arial" font-size="11.00">10. Retry StartForwarding()</text>
</g>
<!-- s2_9&#45;&gt;s2_10 -->
<g id="edge21" class="edge">
<title>s2_9&#45;&gt;s2_10</title>
<path fill="none" stroke="black" d="M2560.73,-644C2560.73,-644 2661.82,-644 2661.82,-644"/>
<polygon fill="black" stroke="black" points="2661.82,-647.5 2671.82,-644 2661.82,-640.5 2661.82,-647.5"/>
</g>
<!-- s2_11 -->
<g id="node27" class="node">
<title>s2_11</title>
<polygon fill="#ffcc80" stroke="black" stroke-dasharray="5,2" points="3041.25,-662 2931.5,-662 2931.5,-626 3041.25,-626 3041.25,-662"/>
<text xml:space="preserve" text-anchor="middle" x="2986.38" y="-647.05" font-family="Arial" font-size="11.00">11. Server assigns</text>
<text xml:space="preserve" text-anchor="middle" x="2986.38" y="-633.55" font-family="Arial" font-size="11.00">WRONG hostname</text>
</g>
<!-- s2_10&#45;&gt;s2_11 -->
<g id="edge22" class="edge">
<title>s2_10&#45;&gt;s2_11</title>
<path fill="none" stroke="black" d="M2822.86,-644C2822.86,-644 2919.68,-644 2919.68,-644"/>
<polygon fill="black" stroke="black" points="2919.68,-647.5 2929.68,-644 2919.68,-640.5 2919.68,-647.5"/>
</g>
<!-- s2_12 -->
<g id="node28" class="node">
<title>s2_12</title>
<path fill="#ffcc80" stroke="black" d="M3291.5,-662C3291.5,-662 3162.25,-662 3162.25,-662 3156.25,-662 3150.25,-656 3150.25,-650 3150.25,-650 3150.25,-638 3150.25,-638 3150.25,-632 3156.25,-626 3162.25,-626 3162.25,-626 3291.5,-626 3291.5,-626 3297.5,-626 3303.5,-632 3303.5,-638 3303.5,-638 3303.5,-650 3303.5,-650 3303.5,-656 3297.5,-662 3291.5,-662"/>
<text xml:space="preserve" text-anchor="middle" x="3226.88" y="-647.05" font-family="Arial" font-size="11.00">12. Hostname validation fails</text>
<text xml:space="preserve" text-anchor="middle" x="3226.88" y="-633.55" font-family="Arial" font-size="11.00">return error</text>
</g>
<!-- s2_11&#45;&gt;s2_12 -->
<g id="edge23" class="edge">
<title>s2_11&#45;&gt;s2_12</title>
<path fill="none" stroke="black" d="M3041.55,-644C3041.55,-644 3138.57,-644 3138.57,-644"/>
<polygon fill="black" stroke="black" points="3138.57,-647.5 3148.57,-644 3138.57,-640.5 3138.57,-647.5"/>
</g>
<!-- s2_13 -->
<g id="node29" class="node">
<title>s2_13</title>
<path fill="#90caf9" stroke="black" d="M3529.75,-668.25C3529.75,-668.25 3424.5,-668.25 3424.5,-668.25 3418.5,-668.25 3412.5,-662.25 3412.5,-656.25 3412.5,-656.25 3412.5,-631.75 3412.5,-631.75 3412.5,-625.75 3418.5,-619.75 3424.5,-619.75 3424.5,-619.75 3529.75,-619.75 3529.75,-619.75 3535.75,-619.75 3541.75,-625.75 3541.75,-631.75 3541.75,-631.75 3541.75,-656.25 3541.75,-656.25 3541.75,-662.25 3535.75,-668.25 3529.75,-668.25"/>
<text xml:space="preserve" text-anchor="middle" x="3477.12" y="-653.8" font-family="Arial" font-size="11.00">13. SetRoute() fails</text>
<text xml:space="preserve" text-anchor="middle" x="3477.12" y="-640.3" font-family="Arial" font-size="11.00">Kubernetes exponential</text>
<text xml:space="preserve" text-anchor="middle" x="3477.12" y="-626.8" font-family="Arial" font-size="11.00">backoff retry</text>
</g>
<!-- s2_12&#45;&gt;s2_13 -->
<g id="edge24" class="edge">
<title>s2_12&#45;&gt;s2_13</title>
<path fill="none" stroke="black" d="M3303.66,-644C3303.66,-644 3400.78,-644 3400.78,-644"/>
<polygon fill="black" stroke="black" points="3400.78,-647.5 3410.78,-644 3400.78,-640.5 3400.78,-647.5"/>
</g>
<!-- s3_1 -->
<g id="node30" class="node">
<title>s3_1</title>
<path fill="#c8e6c9" stroke="black" d="M262,-762C262,-762 171,-762 171,-762 165,-762 159,-756 159,-750 159,-750 159,-738 159,-738 159,-732 165,-726 171,-726 171,-726 262,-726 262,-726 268,-726 274,-732 274,-738 274,-738 274,-750 274,-750 274,-756 268,-762 262,-762"/>
<text xml:space="preserve" text-anchor="middle" x="216.5" y="-747.05" font-family="Arial" font-size="11.00">1. Route.Reconcile()</text>
<text xml:space="preserve" text-anchor="middle" x="216.5" y="-733.55" font-family="Arial" font-size="11.00">every 10s</text>
</g>
<!-- s3_2 -->
<g id="node31" class="node">
<title>s3_2</title>
<path fill="#a5d6a7" stroke="black" d="M721.5,-762C721.5,-762 612.5,-762 612.5,-762 606.5,-762 600.5,-756 600.5,-750 600.5,-750 600.5,-738 600.5,-738 600.5,-732 606.5,-726 612.5,-726 612.5,-726 721.5,-726 721.5,-726 727.5,-726 733.5,-732 733.5,-738 733.5,-738 733.5,-750 733.5,-750 733.5,-756 727.5,-762 721.5,-762"/>
<text xml:space="preserve" text-anchor="middle" x="667" y="-740.3" font-family="Arial" font-size="11.00">2. GW.SetRoute() called</text>
</g>
<!-- s3_1&#45;&gt;s3_2 -->
<g id="edge25" class="edge">
<title>s3_1&#45;&gt;s3_2</title>
<path fill="none" stroke="black" d="M274.47,-744C274.47,-744 588.58,-744 588.58,-744"/>
<polygon fill="black" stroke="black" points="588.58,-747.5 598.58,-744 588.58,-740.5 588.58,-747.5"/>
</g>
<!-- s3_3 -->
<g id="node32" class="node">
<title>s3_3</title>
<path fill="#a5d6a7" stroke="black" d="M1040.75,-762C1040.75,-762 913,-762 913,-762 907,-762 901,-756 901,-750 901,-750 901,-738 901,-738 901,-732 907,-726 913,-726 913,-726 1040.75,-726 1040.75,-726 1046.75,-726 1052.75,-732 1052.75,-738 1052.75,-738 1052.75,-750 1052.75,-750 1052.75,-756 1046.75,-762 1040.75,-762"/>
<text xml:space="preserve" text-anchor="middle" x="976.88" y="-747.05" font-family="Arial" font-size="11.00">3. isRouteAlreadyAttached()</text>
<text xml:space="preserve" text-anchor="middle" x="976.88" y="-733.55" font-family="Arial" font-size="11.00">checks listener.route</text>
</g>
<!-- s3_2&#45;&gt;s3_3 -->
<g id="edge26" class="edge">
<title>s3_2&#45;&gt;s3_3</title>
<path fill="none" stroke="black" d="M733.86,-744C733.86,-744 889.08,-744 889.08,-744"/>
<polygon fill="black" stroke="black" points="889.08,-747.5 899.08,-744 889.08,-740.5 889.08,-747.5"/>
</g>
<!-- s3_4 -->
<g id="node33" class="node">
<title>s3_4</title>
<path fill="#a5d6a7" stroke="black" d="M1309.75,-762C1309.75,-762 1173.75,-762 1173.75,-762 1167.75,-762 1161.75,-756 1161.75,-750 1161.75,-750 1161.75,-738 1161.75,-738 1161.75,-732 1167.75,-726 1173.75,-726 1173.75,-726 1309.75,-726 1309.75,-726 1315.75,-726 1321.75,-732 1321.75,-738 1321.75,-738 1321.75,-750 1321.75,-750 1321.75,-756 1315.75,-762 1309.75,-762"/>
<text xml:space="preserve" text-anchor="middle" x="1241.75" y="-747.05" font-family="Arial" font-size="11.00">4. isForwardingValid()</text>
<text xml:space="preserve" text-anchor="middle" x="1241.75" y="-733.55" font-family="Arial" font-size="11.00">calls GetAssignedAddresses()</text>
</g>
<!-- s3_3&#45;&gt;s3_4 -->
<g id="edge27" class="edge">
<title>s3_3&#45;&gt;s3_4</title>
<path fill="none" stroke="black" d="M1053.13,-744C1053.13,-744 1149.9,-744 1149.9,-744"/>
<polygon fill="black" stroke="black" points="1149.9,-747.5 1159.9,-744 1149.9,-740.5 1149.9,-747.5"/>
</g>
<!-- s3_5 -->
<g id="node34" class="node">
<title>s3_5</title>
<path fill="#ffcc80" stroke="black" d="M1553.25,-762C1553.25,-762 1448,-762 1448,-762 1442,-762 1436,-756 1436,-750 1436,-750 1436,-738 1436,-738 1436,-732 1442,-726 1448,-726 1448,-726 1553.25,-726 1553.25,-726 1559.25,-726 1565.25,-732 1565.25,-738 1565.25,-738 1565.25,-750 1565.25,-750 1565.25,-756 1559.25,-762 1553.25,-762"/>
<text xml:space="preserve" text-anchor="middle" x="1500.62" y="-747.05" font-family="Arial" font-size="11.00">5. assignedAddrs exists</text>
<text xml:space="preserve" text-anchor="middle" x="1500.62" y="-733.55" font-family="Arial" font-size="11.00">hostname matches</text>
</g>
<!-- s3_4&#45;&gt;s3_5 -->
<g id="edge28" class="edge">
<title>s3_4&#45;&gt;s3_5</title>
<path fill="none" stroke="black" d="M1322.24,-744C1322.24,-744 1424.26,-744 1424.26,-744"/>
<polygon fill="black" stroke="black" points="1424.26,-747.5 1434.26,-744 1424.26,-740.5 1424.26,-747.5"/>
</g>
<!-- s3_6 -->
<g id="node35" class="node">
<title>s3_6</title>
<path fill="#a5d6a7" stroke="black" d="M1798.25,-762C1798.25,-762 1702.75,-762 1702.75,-762 1696.75,-762 1690.75,-756 1690.75,-750 1690.75,-750 1690.75,-738 1690.75,-738 1690.75,-732 1696.75,-726 1702.75,-726 1702.75,-726 1798.25,-726 1798.25,-726 1804.25,-726 1810.25,-732 1810.25,-738 1810.25,-738 1810.25,-750 1810.25,-750 1810.25,-756 1804.25,-762 1798.25,-762"/>
<text xml:space="preserve" text-anchor="middle" x="1750.5" y="-747.05" font-family="Arial" font-size="11.00">6. Return success</text>
<text xml:space="preserve" text-anchor="middle" x="1750.5" y="-733.55" font-family="Arial" font-size="11.00">(no&#45;op, no SSH calls)</text>
</g>
<!-- s3_5&#45;&gt;s3_6 -->
<g id="edge29" class="edge">
<title>s3_5&#45;&gt;s3_6</title>
<path fill="none" stroke="black" d="M1565.62,-744C1565.62,-744 1679.02,-744 1679.02,-744"/>
<polygon fill="black" stroke="black" points="1679.02,-747.5 1689.02,-744 1679.02,-740.5 1679.02,-747.5"/>
</g>
<!-- invariants -->
<g id="node36" class="node">
<title>invariants</title>
<path fill="lightgrey" stroke="none" d="M421,-1174.25C421,-1174.25 12,-1174.25 12,-1174.25 6,-1174.25 0,-1168.25 0,-1162.25 0,-1162.25 0,-831.75 0,-831.75 0,-825.75 6,-819.75 12,-819.75 12,-819.75 421,-819.75 421,-819.75 427,-819.75 433,-825.75 433,-831.75 433,-831.75 433,-1162.25 433,-1162.25 433,-1168.25 427,-1174.25 421,-1174.25"/>
<polygon fill="#ffcdd2" stroke="none" points="8,-1138.75 8,-1170.25 425,-1170.25 425,-1138.75 8,-1138.75"/>
<polygon fill="none" stroke="black" points="8,-1138.75 8,-1170.25 425,-1170.25 425,-1138.75 8,-1138.75"/>
<text xml:space="preserve" text-anchor="start" x="155.38" y="-1151.8" font-family="Arial" font-weight="bold" font-size="11.00">Critical State Invariants</text>
<polygon fill="none" stroke="black" points="8,-1093.75 8,-1138.75 80.75,-1138.75 80.75,-1093.75 8,-1093.75"/>
<text xml:space="preserve" text-anchor="start" x="17" y="-1113.55" font-family="Arial" font-weight="bold" font-size="11.00">Invariant 1</text>
<polygon fill="none" stroke="black" points="80.75,-1093.75 80.75,-1138.75 425,-1138.75 425,-1093.75 80.75,-1093.75"/>
<text xml:space="preserve" text-anchor="start" x="102.88" y="-1119.3" font-family="Arial" font-size="11.00">forwardings and assignedAddrs are ALWAYS cleaned together</text>
<text xml:space="preserve" text-anchor="start" x="181.25" y="-1105.8" font-family="Arial" font-size="11.00">(closeClient, StopForwarding)</text>
<polygon fill="none" stroke="black" points="8,-1048.75 8,-1093.75 80.75,-1093.75 80.75,-1048.75 8,-1048.75"/>
<text xml:space="preserve" text-anchor="start" x="17" y="-1068.55" font-family="Arial" font-weight="bold" font-size="11.00">Invariant 2</text>
<polygon fill="none" stroke="black" points="80.75,-1048.75 80.75,-1093.75 425,-1093.75 425,-1048.75 80.75,-1048.75"/>
<text xml:space="preserve" text-anchor="start" x="114.88" y="-1074.3" font-family="Arial" font-size="11.00">listener.route != nil does NOT guarantee forwarding exists</text>
<text xml:space="preserve" text-anchor="start" x="150.12" y="-1060.8" font-family="Arial" font-size="11.00">(controller restart or SSH reconnect cases)</text>
<polygon fill="none" stroke="black" points="8,-1003.75 8,-1048.75 80.75,-1048.75 80.75,-1003.75 8,-1003.75"/>
<text xml:space="preserve" text-anchor="start" x="17" y="-1023.55" font-family="Arial" font-weight="bold" font-size="11.00">Invariant 3</text>
<polygon fill="none" stroke="black" points="80.75,-1003.75 80.75,-1048.75 425,-1048.75 425,-1003.75 80.75,-1003.75"/>
<text xml:space="preserve" text-anchor="start" x="92" y="-1029.3" font-family="Arial" font-size="11.00">assignedAddrs is the ONLY source of truth for forwarding existence</text>
<text xml:space="preserve" text-anchor="start" x="209.38" y="-1015.8" font-family="Arial" font-size="11.00">(not listener.route)</text>
<polygon fill="none" stroke="black" points="8,-958.75 8,-1003.75 80.75,-1003.75 80.75,-958.75 8,-958.75"/>
<text xml:space="preserve" text-anchor="start" x="17" y="-978.55" font-family="Arial" font-weight="bold" font-size="11.00">Invariant 4</text>
<polygon fill="none" stroke="black" points="80.75,-958.75 80.75,-1003.75 425,-1003.75 425,-958.75 80.75,-958.75"/>
<text xml:space="preserve" text-anchor="start" x="140.38" y="-984.3" font-family="Arial" font-size="11.00">Hostname validation happens in SSH Manager</text>
<text xml:space="preserve" text-anchor="start" x="150.5" y="-970.8" font-family="Arial" font-size="11.00">(fail fast if server assigns wrong hostname)</text>
<polygon fill="none" stroke="black" points="8,-913.75 8,-958.75 80.75,-958.75 80.75,-913.75 8,-913.75"/>
<text xml:space="preserve" text-anchor="start" x="17" y="-933.55" font-family="Arial" font-weight="bold" font-size="11.00">Invariant 5</text>
<polygon fill="none" stroke="black" points="80.75,-913.75 80.75,-958.75 425,-958.75 425,-913.75 80.75,-913.75"/>
<text xml:space="preserve" text-anchor="start" x="117.12" y="-939.3" font-family="Arial" font-size="11.00">GetAssignedAddresses uses RLock for concurrent reads</text>
<text xml:space="preserve" text-anchor="start" x="150.12" y="-925.8" font-family="Arial" font-size="11.00">(called frequently by periodic reconciliation)</text>
<polygon fill="none" stroke="black" points="8,-868.75 8,-913.75 80.75,-913.75 80.75,-868.75 8,-868.75"/>
<text xml:space="preserve" text-anchor="start" x="17" y="-888.55" font-family="Arial" font-weight="bold" font-size="11.00">Invariant 6</text>
<polygon fill="none" stroke="black" points="80.75,-868.75 80.75,-913.75 425,-913.75 425,-868.75 80.75,-868.75"/>
<text xml:space="preserve" text-anchor="start" x="125" y="-894.3" font-family="Arial" font-size="11.00">Lock hierarchy: clientMu acquired before addrNotifMu</text>
<text xml:space="preserve" text-anchor="start" x="203" y="-880.8" font-family="Arial" font-size="11.00">(prevents deadlocks)</text>
<polygon fill="none" stroke="black" points="8,-823.75 8,-868.75 80.75,-868.75 80.75,-823.75 8,-823.75"/>
<text xml:space="preserve" text-anchor="start" x="19.62" y="-843.55" font-family="Arial" font-weight="bold" font-size="11.00">Recovery</text>
<polygon fill="none" stroke="black" points="80.75,-823.75 80.75,-868.75 425,-868.75 425,-823.75 80.75,-823.75"/>
<text xml:space="preserve" text-anchor="start" x="89.75" y="-849.3" font-family="Arial" font-size="11.00">isForwardingValid() detects stale state → clear listener.route → retry</text>
<text xml:space="preserve" text-anchor="start" x="129.12" y="-835.8" font-family="Arial" font-size="11.00">Kubernetes exponential backoff handles retry timing</text>
</g>
<!-- validation -->
<g id="node37" class="node">
<title>validation</title>
<path fill="lightgrey" stroke="none" d="M393.25,-1429.5C393.25,-1429.5 39.75,-1429.5 39.75,-1429.5 33.75,-1429.5 27.75,-1423.5 27.75,-1417.5 27.75,-1417.5 27.75,-1244.5 27.75,-1244.5 27.75,-1238.5 33.75,-1232.5 39.75,-1232.5 39.75,-1232.5 393.25,-1232.5 393.25,-1232.5 399.25,-1232.5 405.25,-1238.5 405.25,-1244.5 405.25,-1244.5 405.25,-1417.5 405.25,-1417.5 405.25,-1423.5 399.25,-1429.5 393.25,-1429.5"/>
<polygon fill="#e1bee7" stroke="none" points="35.75,-1394 35.75,-1425.5 397.25,-1425.5 397.25,-1394 35.75,-1394"/>
<polygon fill="none" stroke="black" points="35.75,-1394 35.75,-1425.5 397.25,-1425.5 397.25,-1394 35.75,-1394"/>
<text xml:space="preserve" text-anchor="start" x="149.38" y="-1407.05" font-family="Arial" font-weight="bold" font-size="11.00">isForwardingValid() Logic</text>
<polygon fill="none" stroke="black" points="35.75,-1362.5 35.75,-1394 85.25,-1394 85.25,-1362.5 35.75,-1362.5"/>
<text xml:space="preserve" text-anchor="start" x="44.75" y="-1374.55" font-family="Arial" font-size="11.00">Step 1</text>
<polygon fill="none" stroke="black" points="85.25,-1362.5 85.25,-1394 397.25,-1394 397.25,-1362.5 85.25,-1362.5"/>
<text xml:space="preserve" text-anchor="start" x="112.25" y="-1374.55" font-family="Arial" font-size="11.00">Call GetAssignedAddresses(remoteHost, remotePort)</text>
<polygon fill="none" stroke="black" points="35.75,-1331 35.75,-1362.5 85.25,-1362.5 85.25,-1331 35.75,-1331"/>
<text xml:space="preserve" text-anchor="start" x="44.75" y="-1343.05" font-family="Arial" font-size="11.00">Step 2</text>
<polygon fill="none" stroke="black" points="85.25,-1331 85.25,-1362.5 397.25,-1362.5 397.25,-1331 85.25,-1331"/>
<text xml:space="preserve" text-anchor="start" x="125.75" y="-1343.05" font-family="Arial" font-size="11.00">If len(addrs) == 0 → return false (no forwarding)</text>
<polygon fill="none" stroke="black" points="35.75,-1299.5 35.75,-1331 85.25,-1331 85.25,-1299.5 35.75,-1299.5"/>
<text xml:space="preserve" text-anchor="start" x="44.75" y="-1311.55" font-family="Arial" font-size="11.00">Step 3</text>
<polygon fill="none" stroke="black" points="85.25,-1299.5 85.25,-1331 397.25,-1331 397.25,-1299.5 85.25,-1299.5"/>
<text xml:space="preserve" text-anchor="start" x="119.75" y="-1311.55" font-family="Arial" font-size="11.00">If remoteHost == &quot;0.0.0.0&quot; → return true (wildcard)</text>
<polygon fill="none" stroke="black" points="35.75,-1268 35.75,-1299.5 85.25,-1299.5 85.25,-1268 35.75,-1268"/>
<text xml:space="preserve" text-anchor="start" x="44.75" y="-1280.05" font-family="Arial" font-size="11.00">Step 4</text>
<polygon fill="none" stroke="black" points="85.25,-1268 85.25,-1299.5 397.25,-1299.5 397.25,-1268 85.25,-1268"/>
<text xml:space="preserve" text-anchor="start" x="94.25" y="-1280.05" font-family="Arial" font-size="11.00">For each addr in addrs: if contains(remoteHost) → return true</text>
<polygon fill="none" stroke="black" points="35.75,-1236.5 35.75,-1268 85.25,-1268 85.25,-1236.5 35.75,-1236.5"/>
<text xml:space="preserve" text-anchor="start" x="44.75" y="-1248.55" font-family="Arial" font-size="11.00">Step 5</text>
<polygon fill="none" stroke="black" points="85.25,-1236.5 85.25,-1268 397.25,-1268 397.25,-1236.5 85.25,-1236.5"/>
<text xml:space="preserve" text-anchor="start" x="161" y="-1248.55" font-family="Arial" font-size="11.00">return false (hostname mismatch)</text>
</g>
<!-- state_machine -->
<g id="node38" class="node">
<title>state_machine</title>
<path fill="lightgrey" stroke="none" d="M392.5,-1684.5C392.5,-1684.5 40.5,-1684.5 40.5,-1684.5 34.5,-1684.5 28.5,-1678.5 28.5,-1672.5 28.5,-1672.5 28.5,-1499.5 28.5,-1499.5 28.5,-1493.5 34.5,-1487.5 40.5,-1487.5 40.5,-1487.5 392.5,-1487.5 392.5,-1487.5 398.5,-1487.5 404.5,-1493.5 404.5,-1499.5 404.5,-1499.5 404.5,-1672.5 404.5,-1672.5 404.5,-1678.5 398.5,-1684.5 392.5,-1684.5"/>
<polygon fill="#b2dfdb" stroke="none" points="36.5,-1649 36.5,-1680.5 396.5,-1680.5 396.5,-1649 36.5,-1649"/>
<polygon fill="none" stroke="black" points="36.5,-1649 36.5,-1680.5 396.5,-1680.5 396.5,-1649 36.5,-1649"/>
<text xml:space="preserve" text-anchor="start" x="162.5" y="-1662.05" font-family="Arial" font-weight="bold" font-size="11.00">Route State Machine</text>
<polygon fill="none" stroke="black" points="36.5,-1617.5 36.5,-1649 143.75,-1649 143.75,-1617.5 36.5,-1617.5"/>
<text xml:space="preserve" text-anchor="start" x="76.62" y="-1630.55" font-family="Arial" font-weight="bold" font-size="11.00">State</text>
<polygon fill="none" stroke="black" points="143.75,-1617.5 143.75,-1649 230.75,-1649 230.75,-1617.5 143.75,-1617.5"/>
<text xml:space="preserve" text-anchor="start" x="152.75" y="-1630.55" font-family="Arial" font-weight="bold" font-size="11.00">listener.route</text>
<polygon fill="none" stroke="black" points="230.75,-1617.5 230.75,-1649 396.5,-1649 396.5,-1617.5 230.75,-1617.5"/>
<text xml:space="preserve" text-anchor="start" x="273.88" y="-1630.55" font-family="Arial" font-weight="bold" font-size="11.00">assignedAddrs</text>
<polygon fill="none" stroke="black" points="36.5,-1586 36.5,-1617.5 143.75,-1617.5 143.75,-1586 36.5,-1586"/>
<text xml:space="preserve" text-anchor="start" x="59" y="-1598.05" font-family="Arial" font-size="11.00">Not Attached</text>
<polygon fill="none" stroke="black" points="143.75,-1586 143.75,-1617.5 230.75,-1617.5 230.75,-1586 143.75,-1586"/>
<text xml:space="preserve" text-anchor="start" x="182" y="-1598.05" font-family="Arial" font-size="11.00">nil</text>
<polygon fill="none" stroke="black" points="230.75,-1586 230.75,-1617.5 396.5,-1617.5 396.5,-1586 230.75,-1586"/>
<text xml:space="preserve" text-anchor="start" x="299" y="-1598.05" font-family="Arial" font-size="11.00">empty</text>
<polygon fill="none" stroke="black" points="36.5,-1554.5 36.5,-1586 143.75,-1586 143.75,-1554.5 36.5,-1554.5"/>
<text xml:space="preserve" text-anchor="start" x="50.38" y="-1566.55" font-family="Arial" font-size="11.00">Attached &amp; Valid</text>
<polygon fill="none" stroke="black" points="143.75,-1554.5 143.75,-1586 230.75,-1586 230.75,-1554.5 143.75,-1554.5"/>
<text xml:space="preserve" text-anchor="start" x="171.12" y="-1566.55" font-family="Arial" font-size="11.00">non&#45;nil</text>
<polygon fill="none" stroke="black" points="230.75,-1554.5 230.75,-1586 396.5,-1586 396.5,-1554.5 230.75,-1554.5"/>
<text xml:space="preserve" text-anchor="start" x="251.75" y="-1566.55" font-family="Arial" font-size="11.00">exists, hostname matches</text>
<polygon fill="none" stroke="black" points="36.5,-1523 36.5,-1554.5 143.75,-1554.5 143.75,-1523 36.5,-1523"/>
<text xml:space="preserve" text-anchor="start" x="45.5" y="-1535.05" font-family="Arial" font-size="11.00">Stale (needs retry)</text>
<polygon fill="none" stroke="black" points="143.75,-1523 143.75,-1554.5 230.75,-1554.5 230.75,-1523 143.75,-1523"/>
<text xml:space="preserve" text-anchor="start" x="171.12" y="-1535.05" font-family="Arial" font-size="11.00">non&#45;nil</text>
<polygon fill="none" stroke="black" points="230.75,-1523 230.75,-1554.5 396.5,-1554.5 396.5,-1523 230.75,-1523"/>
<text xml:space="preserve" text-anchor="start" x="239.75" y="-1535.05" font-family="Arial" font-size="11.00">empty OR hostname mismatch</text>
<polygon fill="none" stroke="black" points="36.5,-1491.5 36.5,-1523 143.75,-1523 143.75,-1491.5 36.5,-1491.5"/>
<text xml:space="preserve" text-anchor="start" x="48.5" y="-1503.55" font-family="Arial" font-size="11.00">Adopting Existing</text>
<polygon fill="none" stroke="black" points="143.75,-1491.5 143.75,-1523 230.75,-1523 230.75,-1491.5 143.75,-1491.5"/>
<text xml:space="preserve" text-anchor="start" x="157.25" y="-1503.55" font-family="Arial" font-size="11.00">nil → non&#45;nil</text>
<polygon fill="none" stroke="black" points="230.75,-1491.5 230.75,-1523 396.5,-1523 396.5,-1491.5 230.75,-1491.5"/>
<text xml:space="preserve" text-anchor="start" x="245.75" y="-1503.55" font-family="Arial" font-size="11.00">exists (ErrForwardingExists)</text>
</g>
</g>
</svg>
